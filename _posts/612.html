<!doctype html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN">
 <!--<![endif]-->
 <head>      
  <link rel="stylesheet" type="text/css" media="all" href="stylesheets/style.css">     
  <link rel="stylesheet" id="codebox-css" href="stylesheets/codebox.css" type="text/css" media="screen">             
 </head> 
 <body class="single single-post postid-612 single-format-standard content-sidebar"> 
  <div id="page" class="hfeed"> 
   <header id="branding" role="banner"> 
    <hgroup> 
     <h1 id="site-title"><span><a href="http://codelifeliwan.github.io/" title="Code_Life_LiWan" rel="home">Code_Life_LiWan</a></span></h1> 
     <h2 id="site-description">My heart will go on and on…</h2> 
    </hgroup>  
    <!-- #access --> 
   </header>
   <!-- #branding --> 
   <div id="main" class="clearfix"> 
    <div id="primary"> 
     <div id="content" role="main"> 
      <!-- #nav-single --> 
      <article id="post-612" class="post-612 post type-post status-publish format-standard hentry category-professional_exchanges"> 
       <header class="entry-header"> 
        <h1 class="entry-title">自己写的Yeelink的API For Linux</h1> 
        <div class="entry-meta"> 
         <span class="sep">Posted on </span>
         <a href="http://codelifeliwan.github.io/?p=612" title="上午 11:27" rel="bookmark"><time class="entry-date" datetime="2012-10-02T11:27:43+00:00" pubdate>2 十月, 2012</time></a>
         <span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codelifeliwan.github.io/?author=1" title="View all posts by wanli" rel="author">wanli</a></span></span> 
         <span class="sep"> — </span> 
         <span class="comments-link"> <a href="http://codelifeliwan.github.io/?p=612#comments" title="Comment on 自己写的Yeelink的API For Linux">4 Comments ↓</a> </span> 
        </div>
        <!-- .entry-meta --> 
       </header>
       <!-- .entry-header --> 
       <div class="entry-content">
        <div class="entry-content"> 
         <h1>Yeelink&nbsp;API&nbsp;For&nbsp;Linux&nbsp;<span style="font-family: 宋体;">说明</span></h1> 
         <p>1、本程序是在<span style="font-family: 'Times New Roman';">Linux</span><span style="font-family: 宋体;">里面运行。</span></p> 
         <p>2、运行时请将yeelink.h中的<span style="font-family: 'Times New Roman';">#define&nbsp;APIKEY&nbsp;“Your&nbsp;API&nbsp;Key”</span><span style="font-family: 宋体;">引号里面改成您自己的</span><span style="font-family: 'Times New Roman';">API&nbsp;Key（附件中包含了一个API KEY，可以测试）</span><span style="font-family: 宋体;">。</span></p> 
         <p>3、在本程序的<span style="font-family: 'Times New Roman';">main</span>.c中可以写测试程序。</p> 
         <p>4、本程序暂时不支持图片上传、下载操作。</p> 
         <p>5、使用本程序时直接将本程序引入项目即可。</p> 
         <p>6、开放源码。</p> 
         <p>7、编译本程序请<span style="font-family: 'Times New Roman';">cd</span><span style="font-family: 宋体;">到</span>Yeelink目录，直接运行<span style="font-family: 'Times New Roman';">make</span><span style="font-family: 宋体;">命令即可。</span></p> 
         <p>8、本程序需要安装<span style="font-family: 'Times New Roman';">gcc</span><span style="font-family: 宋体;">。</span></p> 
         <p>9、由于时间仓促，代码有些冗余，但是不影响使用。使用者也可自行修改。</p> 
         <p>10、本程序从<span style="font-family: 'Times New Roman';">socket</span><span style="font-family: 宋体;">接收消息时未使用</span><span style="font-family: 'Times New Roman';">select</span><span style="font-family: 宋体;">查询接收，使用者可自行修改。</span></p> 
         <p>压缩包可在此下载：<a href="uploads/2012/10/Yeelink-API-For-Linux.tar.gz">Yeelink-API-For-Linux.tar</a></p> 
         <p>以下为代码：</p> 
         <p>新建文件夹Yeelink，再在文件夹下创建文件夹src:</p> 
         <p><strong><span style="color: red;">~/Yeelink/Yeelink.h</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code1'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6121"> 
             <td class="code" id="p612code1"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#ifndef __YEELINK</span>
<span style="color: #339933;">#define __YEELINK</span>
&nbsp;
<span style="color: #339933;">#include</span>
<span style="color: #339933;">#include</span>
<span style="color: #339933;">#include</span>
<span style="color: #339933;">#include</span>
<span style="color: #339933;">#include&amp;lt;sys/types.h&amp;gt;</span>
<span style="color: #339933;">#include&amp;lt;sys/socket.h&amp;gt;</span>
<span style="color: #339933;">#include&amp;lt;netinet/in.h&amp;gt;</span>
<span style="color: #339933;">#include&amp;lt;arpa/inet.h&amp;gt;</span>
<span style="color: #339933;">#include</span>
<span style="color: #339933;">#include</span>
<span style="color: #339933;">#include</span>
&nbsp;
<span style="color: #339933;">#define HOST_NAME "api.yeelink.net"</span>
<span style="color: #339933;">#define PORT 80</span>
<span style="color: #339933;">#define APIKEY "Your&nbsp;API&nbsp;Key"</span>
<span style="color: #339933;">#define MAXBUFF 1024</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 设备数据结构
 * */</span>
<span style="color: #993333;">struct</span> device<span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>title<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>about<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>tags<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>local<span style="color: #339933;">;</span>
	<span style="color: #993333;">float</span> latitude<span style="color: #339933;">;</span>
	<span style="color: #993333;">float</span> longitude<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 通用传感器
 * */</span>
<span style="color: #993333;">struct</span> sensors<span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>type<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>title<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>about<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>tags<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 数值传感器
 * */</span>
<span style="color: #993333;">struct</span> number_sensors<span style="color: #009900;">{</span>
	<span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sensors<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>name<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>symbol<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 创建设备
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> create_device<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> device <span style="color: #339933;">*</span>dev<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 编辑设备
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> edit_device<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> device <span style="color: #339933;">*</span>dev<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 罗列设备
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>list_devices<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 查看设备
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>show_device<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 删除设备
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>delete_device<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 创建普通传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_sensors<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sen<span style="color: #339933;">,</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 创建数值型传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_numbersensors<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> number_sensors <span style="color: #339933;">*</span>sen<span style="color: #339933;">,</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 编辑普通传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>edit_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #808080; font-style: italic;">/**
 * 编辑数值传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>edit_number_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> number_sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 罗列传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>list_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 查看传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>show_sensor<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 删除传感器
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>delete_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 创建数据点
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_datapoints<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 编辑数据点
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>edit_datapoints<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 查看数据点
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>show_datapoint<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 删除数据点
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>delete_datapoint<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 增加图片   In test.
 * */</span>
<span style="color: #666666; font-style: italic;">//char *create_photo(int devid,int senid,char *photo);</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 获取图像信息
 * */</span>
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>get_imageinfo<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #808080; font-style: italic;">/**
 * 获取图像内容  In test.
 * */</span>
<span style="color: #666666; font-style: italic;">//char *get_image(int devid,int senid,char *key,char *file);</span>
&nbsp;
<span style="color: #339933;">#endif</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/main.c</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code2'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6122"> 
             <td class="code" id="p612code2"><pre class="c" style="font-family:monospace;"><span style="color: #808080; font-style: italic;">/*
 * main.c
 *
 *  Created on: Sep 25, 2012
 *      Author: wanli
 */</span>
<span style="color: #339933;">#include"yeelink.h"</span>
&nbsp;
<span style="color: #993333;">int</span> main<span style="color: #009900;">(</span><span style="color: #009900;">)</span>
<span style="color: #009900;">{</span>
	<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/makefile</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code3'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6123"> 
             <td class="code" id="p612code3"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">################################################################################</span>
<span style="color: #339933;"># Automatically-generated file. Do not edit!</span>
<span style="color: #339933;">################################################################################</span>
&nbsp;
<span style="color: #339933;">-</span>include ..<span style="color: #339933;">/</span>makefile.<span style="color: #202020;">init</span>
&nbsp;
RM <span style="color: #339933;">:=</span> rm <span style="color: #339933;">-</span>rf
&nbsp;
<span style="color: #339933;"># All of the sources participating in the build are defined here</span>
<span style="color: #339933;">-</span>include sources.<span style="color: #202020;">mk</span>
<span style="color: #339933;">-</span>include subdir.<span style="color: #202020;">mk</span>
<span style="color: #339933;">-</span>include src<span style="color: #339933;">/</span>subdir.<span style="color: #202020;">mk</span>
<span style="color: #339933;">-</span>include objects.<span style="color: #202020;">mk</span>
&nbsp;
ifneq <span style="color: #009900;">(</span>$<span style="color: #009900;">(</span>MAKECMDGOALS<span style="color: #009900;">)</span><span style="color: #339933;">,</span>clean<span style="color: #009900;">)</span>
ifneq <span style="color: #009900;">(</span>$<span style="color: #009900;">(</span>strip $<span style="color: #009900;">(</span>C_DEPS<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #009900;">)</span>
<span style="color: #339933;">-</span>include $<span style="color: #009900;">(</span>C_DEPS<span style="color: #009900;">)</span>
endif
endif
&nbsp;
<span style="color: #339933;">-</span>include ..<span style="color: #339933;">/</span>makefile.<span style="color: #202020;">defs</span>
&nbsp;
<span style="color: #339933;"># Add inputs and outputs from these tool invocations to the build variables </span>
&nbsp;
<span style="color: #339933;"># All Target</span>
all<span style="color: #339933;">:</span> Yeelink
&nbsp;
<span style="color: #339933;"># Tool invocations</span>
Yeelink<span style="color: #339933;">:</span> $<span style="color: #009900;">(</span>OBJS<span style="color: #009900;">)</span> $<span style="color: #009900;">(</span>USER_OBJS<span style="color: #009900;">)</span>
	@echo <span style="color: #ff0000;">'Building target: $@'</span>
	@echo <span style="color: #ff0000;">'Invoking: GCC C Linker'</span>
	gcc  <span style="color: #339933;">-</span>o<span style="color: #ff0000;">"Yeelink"</span> $<span style="color: #009900;">(</span>OBJS<span style="color: #009900;">)</span> $<span style="color: #009900;">(</span>USER_OBJS<span style="color: #009900;">)</span> $<span style="color: #009900;">(</span>LIBS<span style="color: #009900;">)</span>
	@echo <span style="color: #ff0000;">'Finished building target: $@'</span>
	@echo <span style="color: #ff0000;">' '</span>
&nbsp;
<span style="color: #339933;"># Other Targets</span>
clean<span style="color: #339933;">:</span>
	<span style="color: #339933;">-</span>$<span style="color: #009900;">(</span>RM<span style="color: #009900;">)</span> $<span style="color: #009900;">(</span>OBJS<span style="color: #009900;">)</span>$<span style="color: #009900;">(</span>C_DEPS<span style="color: #009900;">)</span>$<span style="color: #009900;">(</span>EXECUTABLES<span style="color: #009900;">)</span> Yeelink
	<span style="color: #339933;">-</span>@echo <span style="color: #ff0000;">' '</span>
&nbsp;
.<span style="color: #202020;">PHONY</span><span style="color: #339933;">:</span> all clean dependents
.<span style="color: #202020;">SECONDARY</span><span style="color: #339933;">:</span>
&nbsp;
<span style="color: #339933;">-</span>include ..<span style="color: #339933;">/</span>makefile.<span style="color: #202020;">targets</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/objects.mk</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code4'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6124"> 
             <td class="code" id="p612code4"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">################################################################################</span>
<span style="color: #339933;"># Automatically-generated file. Do not edit!</span>
<span style="color: #339933;">################################################################################</span>
&nbsp;
USER_OBJS <span style="color: #339933;">:=</span>
&nbsp;
LIBS <span style="color: #339933;">:=</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/sources.mk</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code5'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6125"> 
             <td class="code" id="p612code5"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">################################################################################</span>
<span style="color: #339933;"># Automatically-generated file. Do not edit!</span>
<span style="color: #339933;">################################################################################</span>
&nbsp;
O_SRCS <span style="color: #339933;">:=</span> 
C_SRCS <span style="color: #339933;">:=</span> 
S_UPPER_SRCS <span style="color: #339933;">:=</span> 
OBJ_SRCS <span style="color: #339933;">:=</span> 
ASM_SRCS <span style="color: #339933;">:=</span> 
OBJS <span style="color: #339933;">:=</span> 
C_DEPS <span style="color: #339933;">:=</span> 
EXECUTABLES <span style="color: #339933;">:=</span> 
&nbsp;
<span style="color: #339933;"># Every subdirectory with source files must be described here</span>
SUBDIRS <span style="color: #339933;">:=</span> \
src \
. \</pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/subdir.mk</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code6'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6126"> 
             <td class="code" id="p612code6"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">################################################################################</span>
<span style="color: #339933;"># Automatically-generated file. Do not edit!</span>
<span style="color: #339933;">################################################################################</span>
&nbsp;
<span style="color: #339933;"># Add inputs and outputs from these tool invocations to the build variables </span>
C_SRCS <span style="color: #339933;">+=</span> \
..<span style="color: #339933;">/</span>main.<span style="color: #202020;">c</span> 
&nbsp;
OBJS <span style="color: #339933;">+=</span> \
.<span style="color: #339933;">/</span>main.<span style="color: #202020;">o</span> 
&nbsp;
C_DEPS <span style="color: #339933;">+=</span> \
.<span style="color: #339933;">/</span>main.<span style="color: #202020;">d</span> 
&nbsp;
<span style="color: #339933;"># Each subdirectory must supply rules for building sources it contributes</span>
<span style="color: #339933;">%</span>.<span style="color: #202020;">o</span><span style="color: #339933;">:</span> ..<span style="color: #339933;">/%</span>.<span style="color: #202020;">c</span>
	@echo <span style="color: #ff0000;">'Building file: $</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/src/yee.h</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code7'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6127"> 
             <td class="code" id="p612code7"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#ifndef YEE_H_</span>
<span style="color: #339933;">#define YEE_H_</span>
&nbsp;
<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">int</span> getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">void</span> closesocket<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">void</span> init_sockaddr<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> sockaddr_in <span style="color: #339933;">*</span>sockaddr<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host_global<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">int</span> getconnect<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> sockaddr_in <span style="color: #339933;">*</span>sockaddr<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">int</span> sencmd<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> receivecmd<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> receive_to_file<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_deviceinfo<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>url<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> device <span style="color: #339933;">*</span>dev<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_sensorinfo<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>url<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_numbersensorinfo<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>url<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> number_sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_sensorinfo_notype<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>url<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_numbersensorinfo_notype<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>url<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> number_sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_datapointinfo<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>tmps<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #339933;">,</span><span style="color: #993333;">int</span> type<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #339933;">#endif</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/src/base.c</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code8'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6128"> 
             <td class="code" id="p612code8"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#include "../yeelink.h"</span>
&nbsp;
<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host_global<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>host_global<span style="color: #339933;">=</span>gethostbyname<span style="color: #009900;">(</span>HOST_NAME<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		herror<span style="color: #009900;">(</span><span style="color: #ff0000;">"host"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">return</span> host_global<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">int</span> getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sockfd<span style="color: #339933;">=</span>socket<span style="color: #009900;">(</span>AF_INET<span style="color: #339933;">,</span>SOCK_STREAM<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		perror<span style="color: #009900;">(</span><span style="color: #ff0000;">"socket"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">return</span> sockfd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">void</span> closesocket<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	close<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">void</span> init_sockaddr<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> sockaddr_in <span style="color: #339933;">*</span>sockaddr<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host_global<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> buff<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	sockaddr<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>sin_family<span style="color: #339933;">=</span>AF_INET<span style="color: #339933;">;</span>
	sockaddr<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>sin_port<span style="color: #339933;">=</span>htons<span style="color: #009900;">(</span>PORT<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sockaddr<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>sin_addr.<span style="color: #202020;">s_addr</span><span style="color: #339933;">=</span>inet_addr<span style="color: #009900;">(</span>inet_ntop<span style="color: #009900;">(</span>host_global<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>h_addrtype<span style="color: #339933;">,</span>host_global<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>h_addr<span style="color: #339933;">,</span>buff<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>sockaddr<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>sin_zero<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>sockaddr<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>sin_zero<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">int</span> getconnect<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> sockaddr_in <span style="color: #339933;">*</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>connect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span><span style="color: #009900;">(</span><span style="color: #993333;">struct</span> sockaddr<span style="color: #339933;">*</span><span style="color: #009900;">)</span><span style="color: #009900;">(</span>sockaddr<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span><span style="color: #993333;">struct</span> sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		perror<span style="color: #009900;">(</span><span style="color: #ff0000;">"connect"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">int</span> sencmd<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>send<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #339933;">,</span>strlen<span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		perror<span style="color: #009900;">(</span><span style="color: #ff0000;">"send"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> receivecmd<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> buff_2<span style="color: #009900;">[</span>MAXBUFF<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>buff_2<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>buff_2<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>recv<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>buff_2<span style="color: #339933;">,</span>MAXBUFF<span style="color: #339933;">*</span><span style="color: #0000dd;">10</span><span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		perror<span style="color: #009900;">(</span><span style="color: #ff0000;">"receive"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">return</span> buff_2<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">int</span> logfile<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>p<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	FILE <span style="color: #339933;">*</span>fp<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>fp<span style="color: #339933;">=</span>fopen<span style="color: #009900;">(</span>file<span style="color: #339933;">,</span><span style="color: #ff0000;">"a+"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		puts<span style="color: #009900;">(</span><span style="color: #ff0000;">"Open file error!"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	fprintf<span style="color: #009900;">(</span>fp<span style="color: #339933;">,</span><span style="color: #ff0000;">"%s"</span><span style="color: #339933;">,</span>p<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	fclose<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> receive_to_file<span style="color: #009900;">(</span><span style="color: #993333;">int</span> sockfd<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> buff_2<span style="color: #009900;">[</span>MAXBUFF<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	FILE <span style="color: #339933;">*</span>fp<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> len<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>fp<span style="color: #339933;">=</span>fopen<span style="color: #009900;">(</span>file<span style="color: #339933;">,</span><span style="color: #ff0000;">"wb"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		puts<span style="color: #009900;">(</span><span style="color: #ff0000;">"File can not open!"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	fclose<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">do</span><span style="color: #009900;">{</span>
		memset<span style="color: #009900;">(</span>buff_2<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>buff_2<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		len<span style="color: #339933;">=</span>recv<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>buff_2<span style="color: #339933;">,</span>MAXBUFF<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		logfile<span style="color: #009900;">(</span>buff_2<span style="color: #339933;">,</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span><span style="color: #b1b100;">while</span><span style="color: #009900;">(</span>len<span style="color: #339933;">!=</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> file<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> link_deviceinfo<span style="color: #009900;">(</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>url<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> device <span style="color: #339933;">*</span>dev<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> post_cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> buff<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span>MAXBUFF<span style="color: #339933;">/</span><span style="color: #0000dd;">4</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> tmplen<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>post_cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"POST "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span>url<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"  HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"Content-Type: application/x-www-form-urlencoded<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>buff<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"{<span style="color: #000099; font-weight: bold;">\"</span>title<span style="color: #000099; font-weight: bold;">\"</span>:<span style="color: #000099; font-weight: bold;">\"</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #808080; font-style: italic;">/*
ENTERNAME:
	puts("Please enter device name: ");
	gets(tmps);
	tmplen=strlen(tmps);
	if(tmplen30){
		puts("name too long!");
		goto ENTERNAME;
	}
	*/</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span>dev<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>title<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\"</span>,<span style="color: #000099; font-weight: bold;">\"</span>about<span style="color: #000099; font-weight: bold;">\"</span>:<span style="color: #000099; font-weight: bold;">\"</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #808080; font-style: italic;">/*
ENTERDESC:
	puts("Please enter some infomation about the device: ");
	gets(tmps);
	tmplen=strlen(tmps);
	if(tmplen&amp;gt;30){
		puts("description too long!");
		goto ENTERDESC;
	}
	*/</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span>dev<span style="color: #339933;">-&amp;</span>gt<span style="color: #339933;">;</span>about<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\"</span>,<span style="color: #000099; font-weight: bold;">\"</span>tags<span style="color: #000099; font-weight: bold;">\"</span>:[<span style="color: #000099; font-weight: bold;">\"</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #808080; font-style: italic;">/*
ENTERTAGS:
	puts("Pleater tags,seperate with \",\": ");
	gets(tmps);
	if(strlen(tmps)tags[i]!='\0'){
		if(dev-&amp;gt;tags[i]==','){
			strcat(buff,"\",\"");
			i++;
			tmplen+=3;
			continue;
		}
		buff[tmplen++]=dev-&amp;gt;tags[i++];
	}
	buff[tmplen]='\0';
	strcat(buff,"\"],\"location\":{\"local\":\"");
	/*
ENTERLOCATION:
	puts("Please enter your location: ");
	gets(tmps);
	tmplen=strlen(tmps);
	if(tmplenlocal);
	strcat(buff,"\",\"latitude\":");
	/*
ENTERLATITUDE:
	puts("Please enter latitude: ");
	gets(tmps);
	tmplen=strlen(tmps);
	if(tmpslatitude);
	strcat(buff,tmps);
	strcat(buff,",\"longitude\":");
	/*
ENTERLONGITUDE:
	puts("Please enter latitude: ");
	gets(tmps);
	tmplen=strlen(tmps);
	if(tmpslongitude);
	strcat(buff,tmps);
	strcat(buff,"}}");
&nbsp;
	sprintf(tmps,"%d",strlen(buff));
	strcat(post_cmd,"Content-Length: ");
	strcat(post_cmd,tmps);
	strcat(post_cmd,"\r\n\r\n");
	strcat(post_cmd,buff);
&nbsp;
	return post_cmd;
}
&nbsp;
char * link_sensorinfo(char *url,struct sensors *sen){
	char post_cmd[MAXBUFF];
	char buff[MAXBUFF];
	char tmps[MAXBUFF/4];
	int tmplen;
	int i;
	memset(post_cmd,0,sizeof(post_cmd));
	strcat(post_cmd,"POST ");
	strcat(post_cmd,url);
	strcat(post_cmd,"  HTTP/1.1\r\nHost: api.yeelink.net\r\n");
	strcat(post_cmd,"U-ApiKey: ");
	strcat(post_cmd,APIKEY);
	strcat(post_cmd,"\r\n");
	strcat(post_cmd,"Content-Type: application/x-www-form-urlencoded\r\n");
&nbsp;
	memset(buff,0,sizeof(buff));
	strcat(buff,"{\"type\":\"");
	strcat(buff,sen-&amp;gt;type);
	strcat(buff,"\",\"title\":\"");
	strcat(buff,sen-&amp;gt;title);
	strcat(buff,"\",\"about\":\"");
	strcat(buff,sen-&amp;gt;about);
	strcat(buff,"\",\"tags\":[\"");
	i=0;
	tmplen=strlen(buff);
	while(sen-&amp;gt;tags[i]!='\0'){
		if(sen-&amp;gt;tags[i]==','){
			strcat(buff,"\",\"");
			i++;
			tmplen+=3;
			continue;
		}
		buff[tmplen++]=sen-&amp;gt;tags[i++];
	}
	buff[tmplen]='\0';
	strcat(buff,"\"]}");
&nbsp;
	sprintf(tmps,"%d",strlen(buff));
	strcat(post_cmd,"Content-Length: ");
	strcat(post_cmd,tmps);
	strcat(post_cmd,"\r\n\r\n");
	strcat(post_cmd,buff);
&nbsp;
	return post_cmd;
}
&nbsp;
char * link_numbersensorinfo(char *url,struct number_sensors *sen){
	char post_cmd[MAXBUFF];
	char buff[MAXBUFF];
	char tmps[MAXBUFF/4];
	int tmplen;
	int i;
	memset(post_cmd,0,sizeof(post_cmd));
	strcat(post_cmd,"POST ");
	strcat(post_cmd,url);
	strcat(post_cmd,"  HTTP/1.1\r\nHost: api.yeelink.net\r\n");
	strcat(post_cmd,"U-ApiKey: ");
	strcat(post_cmd,APIKEY);
	strcat(post_cmd,"\r\n");
	strcat(post_cmd,"Content-Type: application/x-www-form-urlencoded\r\n");
&nbsp;
	memset(buff,0,sizeof(buff));
	strcat(buff,"{\"type\":\"");
	strcat(buff,sen-&amp;gt;sensors-&amp;gt;type);
	strcat(buff,"\",\"title\":\"");
	strcat(buff,sen-&amp;gt;sensors-&amp;gt;title);
	strcat(buff,"\",\"about\":\"");
	strcat(buff,sen-&amp;gt;sensors-&amp;gt;about);
	strcat(buff,"\",\"tags\":[\"");
	i=0;
	tmplen=strlen(buff);
	while(sen-&amp;gt;sensors-&amp;gt;tags[i]!='\0'){
		if(sen-&amp;gt;sensors-&amp;gt;tags[i]==','){
			strcat(buff,"\",\"");
			i++;
			tmplen+=3;
			continue;
		}
		buff[tmplen++]=sen-&amp;gt;sensors-&amp;gt;tags[i++];
	}
	buff[tmplen]='\0';
	strcat(buff,"\"],\"unit\":{\"name\":\"");
	strcat(buff,sen-&amp;gt;name);
	strcat(buff,"\",\"symbol\":\"");
	strcat(buff,sen-&amp;gt;symbol);
	strcat(buff,"\"}}");
&nbsp;
	sprintf(tmps,"%d",strlen(buff));
	strcat(post_cmd,"Content-Length: ");
	strcat(post_cmd,tmps);
	strcat(post_cmd,"\r\n\r\n");
	strcat(post_cmd,buff);
&nbsp;
	return post_cmd;
}
&nbsp;
char * link_sensorinfo_notype(char *url,struct sensors *sen){
	char post_cmd[MAXBUFF];
	char buff[MAXBUFF];
	char tmps[MAXBUFF/4];
	int tmplen;
	int i;
	memset(post_cmd,0,sizeof(post_cmd));
	strcat(post_cmd,"POST ");
	strcat(post_cmd,url);
	strcat(post_cmd,"  HTTP/1.1\r\nHost: api.yeelink.net\r\n");
	strcat(post_cmd,"U-ApiKey: ");
	strcat(post_cmd,APIKEY);
	strcat(post_cmd,"\r\n");
	strcat(post_cmd,"Content-Type: application/x-www-form-urlencoded\r\n");
&nbsp;
	memset(buff,0,sizeof(buff));
	strcat(buff,"{\"title\":\"");
	strcat(buff,sen-&amp;gt;title);
	strcat(buff,"\",\"about\":\"");
	strcat(buff,sen-&amp;gt;about);
	strcat(buff,"\",\"tags\":[\"");
	i=0;
	tmplen=strlen(buff);
	while(sen-&amp;gt;tags[i]!='\0'){
		if(sen-&amp;gt;tags[i]==','){
			strcat(buff,"\",\"");
			i++;
			tmplen+=3;
			continue;
		}
		buff[tmplen++]=sen-&amp;gt;tags[i++];
	}
	buff[tmplen]='\0';
	strcat(buff,"\"]}");
&nbsp;
	sprintf(tmps,"%d",strlen(buff));
	strcat(post_cmd,"Content-Length: ");
	strcat(post_cmd,tmps);
	strcat(post_cmd,"\r\n\r\n");
	strcat(post_cmd,buff);
&nbsp;
	return post_cmd;
}
&nbsp;
char * link_numbersensorinfo_notype(char *url,struct number_sensors *sen){
	char post_cmd[MAXBUFF];
	char buff[MAXBUFF];
	char tmps[MAXBUFF/4];
	int tmplen;
	int i;
	memset(post_cmd,0,sizeof(post_cmd));
	strcat(post_cmd,"POST ");
	strcat(post_cmd,url);
	strcat(post_cmd,"  HTTP/1.1\r\nHost: api.yeelink.net\r\n");
	strcat(post_cmd,"U-ApiKey: ");
	strcat(post_cmd,APIKEY);
	strcat(post_cmd,"\r\n");
	strcat(post_cmd,"Content-Type: application/x-www-form-urlencoded\r\n");
&nbsp;
	memset(buff,0,sizeof(buff));
	strcat(buff,"{\"title\":\"");
	strcat(buff,sen-&amp;gt;sensors-&amp;gt;title);
	strcat(buff,"\",\"about\":\"");
	strcat(buff,sen-&amp;gt;sensors-&amp;gt;about);
	strcat(buff,"\",\"tags\":[\"");
	i=0;
	tmplen=strlen(buff);
	while(sen-&amp;gt;sensors-&amp;gt;tags[i]!='\0'){
		if(sen-&amp;gt;sensors-&amp;gt;tags[i]==','){
			strcat(buff,"\",\"");
			i++;
			tmplen+=3;
			continue;
		}
		buff[tmplen++]=sen-&amp;gt;sensors-&amp;gt;tags[i++];
	}
	buff[tmplen]='\0';
	strcat(buff,"\"],\"unit\":{\"name\":\"");
	strcat(buff,sen-&amp;gt;name);
	strcat(buff,"\",\"symbol\":\"");
	strcat(buff,sen-&amp;gt;symbol);
	strcat(buff,"\"}}");
&nbsp;
	sprintf(tmps,"%d",strlen(buff));
	strcat(post_cmd,"Content-Length: ");
	strcat(post_cmd,tmps);
	strcat(post_cmd,"\r\n\r\n");
	strcat(post_cmd,buff);
&nbsp;
	return post_cmd;
}
&nbsp;
char * link_datapointinfo(char *url,char *file,int type){
	char post_cmd[MAXBUFF];
	char buff[MAXBUFF];
	char tmps[MAXBUFF/4];
	int tmplen;
	int i;
	FILE *fp;
	char c;
	memset(post_cmd,0,sizeof(post_cmd));
	if(type==0){
		strcat(post_cmd,"POST ");
	}else if(type==1){
		strcat(post_cmd,"PUT ");
	}else{
		printf("The method is : %d\n",type);
	}
	strcat(post_cmd,url);
	strcat(post_cmd,"  HTTP/1.1\r\nHost: api.yeelink.net\r\n");
	strcat(post_cmd,"U-ApiKey: ");
	strcat(post_cmd,APIKEY);
	strcat(post_cmd,"\r\n");
	strcat(post_cmd,"Content-Type: application/x-www-form-urlencoded\r\n");
&nbsp;
	if(NULL==(fp=fopen(file,"r"))){
		puts("File can not open!");
		return NULL;
	}
	memset(buff,0,sizeof(buff));
	i=0;
	while((c=fgetc(fp))!=EOF){
		if(c=='\n'||c==' '||c=='\r'){
			continue;
		}
		buff[i++]=c;
	}
	buff[i]='\0';
	fclose(fp);
&nbsp;
	sprintf(tmps,"%d",strlen(buff));
	strcat(post_cmd,"Content-Length: ");
	strcat(post_cmd,tmps);
	strcat(post_cmd,"\r\n\r\n");
	strcat(post_cmd,buff);
&nbsp;
	return post_cmd;
}
&nbsp;
char *link_photoinfo(char *url,char *file){
	char post_cmd[MAXBUFF];
	char *cmd;
	char buff[MAXBUFF];
	char tmps[MAXBUFF/4];
	char picture[MAXBUFF*101];
	int i;
	FILE *fp;
	int f;
	int tmp;
	char c;
	int tmp_len;
	long long file_len;
	memset(post_cmd,0,sizeof(post_cmd));
	strcat(post_cmd,"POST ");
	strcat(post_cmd,url);
	strcat(post_cmd,"  HTTP/1.1\r\nHost: api.yeelink.net\r\n");
	strcat(post_cmd,"U-ApiKey: ");
	strcat(post_cmd,APIKEY);
	strcat(post_cmd,"\r\n");
	strcat(post_cmd,"Content-Type: multipart/form-data; boundary=--agcsascvascascasca\r\n");
	strcat(post_cmd,"Content-Length: ");
	/**
	 * 加上图片长度，暂时没加上
	 * */</span>
	<span style="color: #666666; font-style: italic;">/////////////////////</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>fp<span style="color: #339933;">=</span>fopen<span style="color: #009900;">(</span>file<span style="color: #339933;">,</span><span style="color: #ff0000;">"rb"</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		puts<span style="color: #009900;">(</span><span style="color: #ff0000;">"File can not open!"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
	fseek<span style="color: #009900;">(</span>fp<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span>SEEK_END<span style="color: #009900;">)</span><span style="color: #339933;">;</span><span style="color: #666666; font-style: italic;">//指针移动到文件末尾</span>
	file_len<span style="color: #339933;">=</span>ftell<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	fclose<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%lld"</span><span style="color: #339933;">,</span>file_len<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Connection: Keep-Alive"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">/////////////////////</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"--agcsascvascascasca<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"Content-Disposition: form-data; name=<span style="color: #000099; font-weight: bold;">\"</span>data<span style="color: #000099; font-weight: bold;">\"</span> "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"filename=<span style="color: #000099; font-weight: bold;">\"</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span>file<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\"</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"Content-Type: application/octet-stream"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>buff<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #808080; font-style: italic;">/**
	 * 加上图片内容
	 * */</span>
	<span style="color: #666666; font-style: italic;">///////////////////////////</span>
	strcat<span style="color: #009900;">(</span>post_cmd<span style="color: #339933;">,</span>buff<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memcpy<span style="color: #009900;">(</span>picture<span style="color: #339933;">,</span>post_cmd<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>post_cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	file_len<span style="color: #339933;">=</span>strlen<span style="color: #009900;">(</span>picture<span style="color: #009900;">)</span><span style="color: #339933;">+</span>MAXBUFF<span style="color: #339933;">;</span>
	fp<span style="color: #339933;">=</span>fopen<span style="color: #009900;">(</span>file<span style="color: #339933;">,</span><span style="color: #ff0000;">"rb"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">while</span><span style="color: #009900;">(</span><span style="color: #339933;">!</span>feof<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		c<span style="color: #339933;">=</span>fgetc<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		picture<span style="color: #009900;">[</span>file_len<span style="color: #339933;">++</span><span style="color: #009900;">]</span><span style="color: #339933;">=</span>c<span style="color: #339933;">;</span>
		<span style="color: #666666; font-style: italic;">//memcpy(&amp;amp;(picture[file_len]),buff,tmp);</span>
		<span style="color: #666666; font-style: italic;">//file_len+=tmp;</span>
	<span style="color: #009900;">}</span>
	fclose<span style="color: #009900;">(</span>fp<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #666666; font-style: italic;">//memcpy(&amp;amp;(picture[file_len]),buff,tmp);</span>
	<span style="color: #666666; font-style: italic;">//file_len+=tmp;</span>
	<span style="color: #666666; font-style: italic;">///////////////////////////</span>
	<span style="color: #666666; font-style: italic;">//strcat(buff,"\r\n--agcsascvascascasca\r\n");</span>
	cmd<span style="color: #339933;">=</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>--agcsascvascascasca<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #339933;">;</span>
	memcpy<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span><span style="color: #009900;">(</span>picture<span style="color: #009900;">[</span>file_len<span style="color: #009900;">]</span><span style="color: #009900;">)</span><span style="color: #339933;">,</span>cmd<span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #666666; font-style: italic;">//strcat(post_cmd,buff);</span>
&nbsp;
	<span style="color: #b1b100;">return</span> picture<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/src/datapoint.c</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code9'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p6129"> 
             <td class="code" id="p612code9"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#include "../yeelink.h"</span>
<span style="color: #339933;">#include "yee.h"</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_datapoints<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/datapoints"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	cmd<span style="color: #339933;">=</span>link_datapointinfo<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>file<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>edit_datapoints<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">100</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/datapoint/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	cmd<span style="color: #339933;">=</span>link_datapointinfo<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>file<span style="color: #339933;">,</span><span style="color: #0000dd;">1</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>show_datapoint<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">!=</span>key<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/datapoint/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>delete_datapoint<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"DELETE /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/datapoint/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_photo<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>photo<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>buff<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/photos"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	cmd<span style="color: #339933;">=</span>link_photoinfo<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>photo<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>buff<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> buff<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>get_imageinfo<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">!=</span>key<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/photo/info/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span><span style="color: #b1b100;">else</span><span style="color: #009900;">{</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/photo/info"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>get_image<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>key<span style="color: #339933;">,</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>file<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">!=</span>key<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/photo/content/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>key<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span><span style="color: #b1b100;">else</span><span style="color: #009900;">{</span>
		strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/photo/content"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
&nbsp;
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receive_to_file<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>file<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/src/device.c</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code10'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p61210"> 
             <td class="code" id="p612code10"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#include "../yeelink.h"</span>
<span style="color: #339933;">#include "yee.h"</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> create_device<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> device <span style="color: #339933;">*</span>dev<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	cmd<span style="color: #339933;">=</span>link_deviceinfo<span style="color: #009900;">(</span><span style="color: #ff0000;">"/v1.0/devices"</span><span style="color: #339933;">,</span>dev<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span> edit_device<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> device <span style="color: #339933;">*</span>dev<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> device_id<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmp_str<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sprintf<span style="color: #009900;">(</span>device_id<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmp_str<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmp_str<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmp_str<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmp_str<span style="color: #339933;">,</span>device_id<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	cmd<span style="color: #339933;">=</span>link_deviceinfo<span style="color: #009900;">(</span>tmp_str<span style="color: #339933;">,</span>dev<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>list_devices<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/devices HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>show_device<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> device_id<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sprintf<span style="color: #009900;">(</span>device_id<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>device_id<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>delete_device<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> device_id<span style="color: #009900;">[</span><span style="color: #0000dd;">30</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sprintf<span style="color: #009900;">(</span>device_id<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"DELETE /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>device_id<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/src/sensors.c</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code11'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p61211"> 
             <td class="code" id="p612code11"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">#include "../yeelink.h"</span>
<span style="color: #339933;">#include "yee.h"</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_sensors<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sen<span style="color: #339933;">,</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensors"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	cmd<span style="color: #339933;">=</span>link_sensorinfo<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>create_numbersensors<span style="color: #009900;">(</span><span style="color: #993333;">struct</span> number_sensors <span style="color: #339933;">*</span>sen<span style="color: #339933;">,</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensors"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	cmd<span style="color: #339933;">=</span>link_numbersensorinfo<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>edit_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	cmd<span style="color: #339933;">=</span>link_sensorinfo_notype<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>edit_number_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #339933;">,</span><span style="color: #993333;">struct</span> number_sensors <span style="color: #339933;">*</span>sen<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>cmd<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps_1<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps_1<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps_1<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>tmps_1<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	cmd<span style="color: #339933;">=</span>link_numbersensorinfo_notype<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span>sen<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>cmd<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> cmd<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>list_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensors HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>show_sensor<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"GET /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span>
&nbsp;
<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>delete_sensors<span style="color: #009900;">(</span><span style="color: #993333;">int</span> devid<span style="color: #339933;">,</span><span style="color: #993333;">int</span> senid<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
	<span style="color: #993333;">char</span> cmd<span style="color: #009900;">[</span>MAXBUFF<span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> tmps<span style="color: #009900;">[</span><span style="color: #0000dd;">50</span><span style="color: #009900;">]</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ret<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> hostent <span style="color: #339933;">*</span>host<span style="color: #339933;">=</span>NULL<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> sockfd<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> sockaddr_in sockaddr<span style="color: #339933;">;</span>
	host<span style="color: #339933;">=</span>gethost<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span>host<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	sockfd<span style="color: #339933;">=</span>getsocket<span style="color: #009900;">(</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	init_sockaddr<span style="color: #009900;">(</span><span style="color: #339933;">&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #339933;">,</span>host<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>getconnect<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,&amp;</span>amp<span style="color: #339933;">;</span>sockaddr<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	memset<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"DELETE /v1.0/device/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>devid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"/sensor/"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	memset<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #0000dd;">0</span><span style="color: #339933;">,</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">(</span>tmps<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	sprintf<span style="color: #009900;">(</span>tmps<span style="color: #339933;">,</span><span style="color: #ff0000;">"%d"</span><span style="color: #339933;">,</span>senid<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>tmps<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">" HTTP/1.1<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>Host: api.yeelink.net<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>U-ApiKey: "</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span>APIKEY<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	strcat<span style="color: #009900;">(</span>cmd<span style="color: #339933;">,</span><span style="color: #ff0000;">"<span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span><span style="color: #000099; font-weight: bold;">\r</span><span style="color: #000099; font-weight: bold;">\n</span>"</span><span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span><span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">==</span><span style="color: #009900;">(</span>sencmd<span style="color: #009900;">(</span>sockfd<span style="color: #339933;">,</span>cmd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	<span style="color: #b1b100;">if</span><span style="color: #009900;">(</span>NULL<span style="color: #339933;">==</span><span style="color: #009900;">(</span>ret<span style="color: #339933;">=</span>receivecmd<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><span style="color: #009900;">{</span>
		<span style="color: #b1b100;">return</span> NULL<span style="color: #339933;">;</span>
	<span style="color: #009900;">}</span>
	closesocket<span style="color: #009900;">(</span>sockfd<span style="color: #009900;">)</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> ret<span style="color: #339933;">;</span>
<span style="color: #009900;">}</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
         <p><strong><span style="color: red;">~/Yeelink/src/subdir.mk</span></strong></p> 
         <div class="wp_codebox_msgheader wp_codebox_hide"> 
          <span class="right"><sup><a href="http://www.ericbess.com/ericblog/2008/03/03/wp-codebox/#examples" target="_blank" title="WP-CodeBox HowTo?"><span style="color: #99cc00">?</span></a></sup></span> 
          <span class="left"><a href="javascript:;" onclick="javascript:showCodeTxt('p612code12'); return false;">View Code</a> C</span> 
          <div class="codebox_clear"></div> 
         </div> 
         <div class="wp_codebox"> 
          <table> 
           <tbody> 
            <tr id="p61212"> 
             <td class="code" id="p612code12"><pre class="c" style="font-family:monospace;"><span style="color: #339933;">################################################################################</span>
<span style="color: #339933;"># Automatically-generated file. Do not edit!</span>
<span style="color: #339933;">################################################################################</span>
&nbsp;
<span style="color: #339933;"># Add inputs and outputs from these tool invocations to the build variables </span>
C_SRCS <span style="color: #339933;">+=</span> \
..<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>base.<span style="color: #202020;">c</span> \
..<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>datapoint.<span style="color: #202020;">c</span> \
..<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>device.<span style="color: #202020;">c</span> \
..<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>sensors.<span style="color: #202020;">c</span> 
&nbsp;
OBJS <span style="color: #339933;">+=</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>base.<span style="color: #202020;">o</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>datapoint.<span style="color: #202020;">o</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>device.<span style="color: #202020;">o</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>sensors.<span style="color: #202020;">o</span> 
&nbsp;
C_DEPS <span style="color: #339933;">+=</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>base.<span style="color: #202020;">d</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>datapoint.<span style="color: #202020;">d</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>device.<span style="color: #202020;">d</span> \
.<span style="color: #339933;">/</span>src<span style="color: #339933;">/</span>sensors.<span style="color: #202020;">d</span> 
&nbsp;
<span style="color: #339933;"># Each subdirectory must supply rules for building sources it contributes</span>
src<span style="color: #339933;">/%</span>.<span style="color: #202020;">o</span><span style="color: #339933;">:</span> ..<span style="color: #339933;">/</span>src<span style="color: #339933;">/%</span>.<span style="color: #202020;">c</span>
	@echo <span style="color: #ff0000;">'Building file: $</span></pre></td> 
            </tr> 
           </tbody> 
          </table> 
         </div> 
        </div>
       </div>
       <!-- .entry-content --> 
       <!-- .entry-meta --> 
      </article>
      <!-- #post-612 --> 
      <!-- #comments --> 
     </div>
     <!-- #content --> 
    </div>
    <!-- #primary --> 
    <!-- #secondary .widget-area --> 
   </div>
   <!-- #main --> 
   <!-- #colophon --> 
  </div>
  <!-- #page -->   
  <!-- JiaThis Button BEGIN -->  
  <!-- JiaThis Button END -->   
 </body>
</html>