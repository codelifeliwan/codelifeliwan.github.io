<!doctype html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN">
 <!--<![endif]-->
 <head>      
  <link rel="stylesheet" type="text/css" media="all" href="stylesheets/style.css">     
  <link rel="stylesheet" id="codebox-css" href="stylesheets/codebox.css" type="text/css" media="screen">             
 </head> 
 <body class="single single-post postid-218 single-format-standard content-sidebar"> 
  <div id="page" class="hfeed"> 
   <header id="branding" role="banner"> 
    <hgroup> 
     <h1 id="site-title"><span><a href="http://codelifeliwan.github.io/" title="Code_Life_LiWan" rel="home">Code_Life_LiWan</a></span></h1> 
     <h2 id="site-description">My heart will go on and on…</h2> 
    </hgroup>  
    <!-- #access --> 
   </header>
   <!-- #branding --> 
   <div id="main" class="clearfix"> 
    <div id="primary"> 
     <div id="content" role="main"> 
      <!-- #nav-single --> 
      <article id="post-218" class="post-218 post type-post status-publish format-standard hentry category-my_operating_system tag-operating"> 
       <header class="entry-header"> 
        <h1 class="entry-title">操作系统引导探究</h1> 
        <div class="entry-meta"> 
         <span class="sep">Posted on </span>
         <a href="http://codelifeliwan.github.io/?p=218" title="下午 10:00" rel="bookmark"><time class="entry-date" datetime="2012-03-01T22:00:32+00:00" pubdate>1 三月, 2012</time></a>
         <span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codelifeliwan.github.io/?author=1" title="View all posts by wanli" rel="author">wanli</a></span></span> 
         <span class="sep"> — </span> 
         <span class="comments-link"> <a href="http://codelifeliwan.github.io/?p=218#respond" title="Comment on 操作系统引导探究">No Comments ↓</a> </span> 
        </div>
        <!-- .entry-meta --> 
       </header>
       <!-- .entry-header --> 
       <div class="entry-content">
        <div class="entry-content"> 
         <div>
           操作系统引导探究 (Version 0.02) （原版） 
         </div> 
         <div>
           哈尔滨工业大学 计算机体系结构实验室 谢煜波 
         </div> 
         <div>
           (xieyubo@126.com)&nbsp; 
          <wbr> 
         </div> 
         <div>
           &nbsp; 
          <wbr> 
         </div> 
         <div>
           Version 0.02修改记录:&nbsp; 
          <wbr> 
         </div> 
         <div>
           &nbsp; 
          <wbr>&nbsp; 
          <wbr> &nbsp; 
          <wbr>对与GDT 
          <br> 有关的段描述符方面的描述进行了修订，更正了上一个版本中出现的一些错误，增加了一些 
         </div> 
         <div>
           描述，使其更完善。&nbsp; 
          <wbr> 
         </div> 
         <div>
           &nbsp; 
          <wbr>&nbsp; 
          <wbr> 
          <br> &nbsp; 
          <wbr>与上个版本中不同的地方均用红色标记。&nbsp; 
          <wbr> 
         </div> 
         <div>
           &nbsp; 
          <wbr> 
         </div> 
         <div>
           前言&nbsp; 
          <wbr> 
         </div> 
         <div>
           本篇文章并不旨在完整的讨论一个多引导系统程序怎样去引导不同的操作系统，而只 
         </div> 
         <div>
           打算从编写操作系统的角度出发，谈谈计算机怎样从加电开始，从无到有，将操作系统运行 
         </div> 
         <div>
           起来，在其中将尽量详尽的描述从实模式到保护模式的过渡，目的只在于能将所学与广大爱 
         </div> 
         <div>
           好者共享，为希望开发操作系统的朋友留下一点资料，也为自己留下一点心得。&nbsp; 
          <wbr> 
         </div> 
         <div>
           本篇文章将以开发中的 pyos 系统引导程序为例，pyos 是一个正在开发中的实验型操作 
         </div> 
         <div>
           系统，它并不打算以目前任何一种运行中的操作系统为模式，而只想通过自己编写一个从头 
         </div> 
         <div>
           到尾的操作系统来学习知识，积累技术，如果你有兴趣，非常欢迎你的加入！&nbsp; 
          <wbr> 
         </div> 
         <div>
           本篇纯属学习过程中的一点心得体会，如果你发现其中有错误或不当之处，非常希望 
         </div> 
         <div>
           你来信指教。&nbsp; 
          <wbr> 
         </div> 
         <div>
           &nbsp; 
          <wbr> 
         </div> 
         <div>
           一、计算机从加电开始都做了什么？&nbsp; 
          <wbr> 
         </div> 
         <div>
           当机算机的电源键被按下时，同这个键相联的电信号线就会送出一个电信号给主板， 
         </div> 
         <div>
           主板将此电信号传给供电系统，供电系统开始工作，为整个系统供电，并送出一个电信号给 
         </div> 
         <div>
           BIOS，通知 BIOS 供电系统已经准备完毕。随后 BIOS启动一个程序，进行主机自检，主机 
         </div> 
         <div>
           自检的主要工作是确保系统的每一个部分都得到了电源支持， 内存储器、 主板上的其它芯片、 
         </div> 
         <div>
           键盘、鼠标、磁盘控制器及一些 I/O 端口正常可用，此后，自检程序将控制权还给 BIOS。 
         </div> 
         <div>
           接下来 BIOS 读取 BIOS 中的相关设置，得到引导驱动器的顺序，然后依次检查，直到找到 
         </div> 
         <div>
           可以用来引导的驱动器（或说可以用来引导的磁盘，包括软盘、硬盘、光盘等） ，然后调用 
         </div> 
         <div>
           这个驱动器上磁盘的引导扇区进行引导。BIOS 是怎么知道或说分辨哪一个磁盘可以用来引 
         </div> 
         <div>
           导的呢？&nbsp; 
          <wbr> 
         </div> 
         <div>
           &nbsp; 
          <wbr> 
         </div> 
         <div>
           二、认识引导程序&nbsp; 
          <wbr> 
         </div> 
         <div>
           BIOS 将磁盘的第一个扇区（磁盘最开始的 512 字节）载入内存，放在 0x0000:0x7c00 
         </div> 
         <div>
           处（见图三） ，如果这个扇区的最后两个字节是“55 AA” ，那么这就是一个引导扇区，这个 
         </div> 
         <div>
           磁盘也就是一块可引导盘。通常这个大小为 512B 的程序就称为引导程序（boot） 。如果最后 
         </div> 
         <div>
           两个字节不是“55 AA” ，那么 BIOS 就检查下一个磁盘驱动器。&nbsp; 
          <wbr> 
         </div> 
         <div>
           通过上面的表述我们可以总结出如下三点引导程序所具有的特点：&nbsp; 
          <wbr> 
         </div> 
         <div>
           1． &nbsp; 
          <wbr>它的大小是 512B，不能多一字节也不能少一字节，因为 BIOS 只读 512B 
          <br> 到内 
         </div> 
         <div>
           存中去。&nbsp; 
          <wbr> 
         </div> 
         <div>
           2． &nbsp; 
          <wbr>它的结尾两字节必须是“55 AA” 
          <br> ，这是引导扇区的标志。&nbsp; 
          <wbr> 
         </div> 
         <div>
           3． &nbsp; 
          <wbr>它总是放在磁盘的第一个扇区上（0 磁头，0 磁道，1 扇区） ，因为 BIOS 
          <br> 只读第一个扇区。&nbsp; 
          <wbr> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s9.sinaimg.cn/orignal/6730a3aagba2ee759c4c8" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s9.sinaimg.cn/middle/6730a3aagba2ee759c4c8&amp;690" width="522" height="425" name="image_operate_39231330610440953" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            因此，在我们编写引导程序的时候，我们也必须注意上面的三点原则，符合上面三点 
          </div> 
          <div>
            原则的程序都可以看作是引导程序，至少 BIOS 是这样认为的，虽然它也许可能是你随意写 
          </div> 
          <div>
            的一段并没有什么实际意义的代码。&nbsp; 
           <wbr> 
          </div> 
          <div>
            因为 BIOS 一次只读一个扇区也即 512 字节的数据到内存中，这显然是不够的，现在操 
          </div> 
          <div>
            作系统都比较庞大，因此我们必须在引导扇区里，将存在磁盘上的操作系统的核心部分读进 
          </div> 
          <div>
            内存，然后再跳转到操作系统的核心部分去执行。&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            三、通过 BIOS读磁盘扇区&nbsp; 
           <wbr> 
          </div> 
          <div>
            从上面的描述我们可以知道，引导程序需要将存在于磁盘上的操作系统读入内存，因 
          </div> 
          <div>
            此这里我们不得不再讲一讲，怎样不通过操作系统（因为现在还没有操作系统）去读取磁盘 
          </div> 
          <div>
            上的内容。一般说来这有两种方法可以实现，一种是直接读写磁盘的 I/O端口，一种是通过 
          </div> 
          <div>
            BIOS 中断实现。前一种方法是最低层的方法（后一种方法也是在它的基础上实现的） ，具有 
          </div> 
          <div>
            极高的灵活性，可以将磁盘上的内容读到内存中的任意地方，但编程复杂。第二种方法是前 
          </div> 
          <div>
            一种方法稍微高层一点的实现，牺牲了一点灵活性，比如，它不能把磁盘上的内容读到 
          </div> 
          <div>
            0x0000:0x0000 ~ 0x0000:0x03FF 处。为什么不能读到此处呢？这里我们将不得不描述一下 
          </div> 
          <div>
            CPU在加电后的中断处理机制。&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            3.1 BIOS 的中断处理&nbsp; 
           <wbr> 
          </div> 
          <div>
            中断是什么？相信学过计算机的人都不会陌生，如果你对中断一点都不了解建议你翻 
          </div> 
          <div>
            看一下《计算机组成原理》 （高等教育出版社 &nbsp; 
           <wbr>唐朔飞） 
           <br> ，上面有非常详尽的描述，而一般的 
          </div> 
          <div>
            汇编教材也多有谈及，因此这里只打算讲讲 BIOS 对中断的处理。&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s12.sinaimg.cn/orignal/6730a3aagba2eeb5807cb" target="_blank"></a> 
          <br> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s5.sinaimg.cn/orignal/6730a3aagba2eec4994e4" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s5.sinaimg.cn/middle/6730a3aagba2eec4994e4&amp;690" width="690" height="592" name="image_operate_53741330610651673" alt="操作系统引导探究" title="操作系统引导探究"></a> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s5.sinaimg.cn/orignal/6730a3aagba2eec4994e4" target="_blank"></a> 
          <p></p> 
          <div>
            由上图（图二）我们可以清楚的看到，当中断信号产生时，中断信号通过“中断地址 
          </div> 
          <div>
            形成部件”产生一个中断向量地址，此向量地址其实就是指向一个实际内存地址的指针，而 
          </div> 
          <div>
            这个实际内存地址中往往安排一条跳转指令（jmp）跳转到实际处理此中断的中断服务程序 
          </div> 
          <div>
            中去执行。这一块专门用于处理中断跳转的内存就被称为中断向量表。在内存中，这块中断 
          </div> 
          <div>
            向量表被放在什么地方呢？而实际的中断处理程序又在什么地方呢？&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            3.2 系统的内存安排（1M）&nbsp; 
           <wbr> 
          </div> 
          <div>
            要回答上面的两个问题，我们需要看看系统中内存是怎么安排的。在 CPU 被加电的时 
          </div> 
          <div>
            候，最初的 1M 的内存，是由 BIOS 为我们安排好了的，每一字节都有特殊的用处。 
          </div> 
          <div> 
           <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s4.sinaimg.cn/orignal/6730a3aatba2ef4b912b3" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s4.sinaimg.cn/middle/6730a3aatba2ef4b912b3&amp;690" width="556" height="542" name="image_operate_19171330610651617" alt="操作系统引导探究" title="操作系统引导探究"></a> 
           <p></p> 
           <div>
             由上图我们现在可以很方便的问答上面提出的两个问题。由于 0x00000~0x003FF 是中 
           </div> 
           <div>
             断向量表所在，因此不能将磁盘中的操作系统读到此处，因为这样会覆盖中断向量表，就无 
           </div> 
           <div>
             法再通过 BIOS 中断读取磁盘内容了。你也许会说：我是先调用中断，再读的啊。但事实上 
           </div> 
           <div>
             BIOS 在读的过程中自己会多次调用其它中断辅助完成。&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             3.3 利用 BIOS 13 号中断读取磁盘扇区&nbsp; 
            <wbr> 
           </div> 
           <div>
             有了前面的描述作为基础，下面我们可以正式描述怎样通过 BIOS 中断读取磁盘扇区 
           </div> 
           <div>
             了。要读取磁盘扇区，我们需要使用 BIOS 的 13 号中断，13 号中断会将几个寄存器的值作 
           </div> 
           <div>
             为其参数，因此，我们在调用 13 号中断的过程中需要首先设置寄存器。那么当怎样设置寄 
           </div> 
           <div>
             存器呢？会用到哪些寄存器呢？请往下看：&nbsp; 
            <wbr> 
           </div> 
           <div>
             AH寄存器：存放功能号，为 2 的时候，表示使用读磁盘功能&nbsp; 
            <wbr> 
           </div> 
           <div>
             DL 寄存器：存驱动器号，表示欲读哪一个驱动器&nbsp; 
            <wbr> 
           </div> 
           <div>
             CH寄存器：存磁头号，表示欲读哪一个磁头&nbsp; 
            <wbr> 
           </div> 
           <div>
             CL 寄存器：存扇区号，表示欲读的起始扇区&nbsp; 
            <wbr> 
           </div> 
           <div>
             AL 寄存器：存计数值，表示欲读入的扇区数量&nbsp; 
            <wbr> 
           </div> 
           <div>
             在设置了这几个寄存器后，我们就可以使用 &nbsp; 
            <wbr>int 13 这条指令调用 BIOS 13 
            <br> 号中断读取 
           </div> 
           <div>
             指定的磁盘扇区，它将磁盘扇区读到 ES:BX 处，因此，在调用它之前，我们实际上还需要 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0x00000~0x003FF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr>中断向量表&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0x00400~0x004FF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> BIOS 
            <br> 数据区&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0x00500~0x07BFF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr>自由内存区&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0x07C00~0x07DFF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> 引导程序加载区&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0x07E00~0x9FFFF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr>自由内存区&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0xA0000~0xBFFFF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr>显示内存区&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             0xC0000~0xFFFFF： &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr>BIOS中断处理程序区 设置 ES与 
            <br> BX寄存器，以指出数据在内存中存放的位置。&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             四、保护模式下，段模式内存地址的访问&nbsp; 
            <wbr> 
           </div> 
           <div>
             写程序离不开对内存的访问，然而在保护模式下内存的访问与在实模式下内存的访问 
           </div> 
           <div>
             完全不同，这里我们将详细描述一下保护模式下内存的访问方法。当然，这里并不打算完整 
           </div> 
           <div>
             的介绍保护模式下所有的内存访问方法与机制， 只介绍从实模式转到保护模式下所需要进行 
           </div> 
           <div>
             的转换，完整的内存访问请你参见《Intel 用户手册》 。当然，随着 pyos的实验进行，我也会 
           </div> 
           <div>
             在后面的实验报告与心得体会中渐渐描述。&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr> 
           </div> 
           <div>
             4.1 实模式下的内存访问&nbsp; 
            <wbr> 
           </div> 
           <div>
             计算机在加电时，处于“实模式” ，在计算机中有一个 CR0 寄存器，又称为 0 号控制寄 
           </div> 
           <div>
             存器，在这个寄存器中，最低位也即第 0 位，被称为 PM（Protected Modle：保护模式）位， 
           </div> 
           <div>
             当它被清零的时候表示 CPU在“实模式”下工作，当它被置位的时候表示 CPU在“保护模 
           </div> 
           <div>
             式”下工作。在计算机加电的时候，它是被清零的，所在这个时候的计算机，处于“实模式” 。 
            <br> &nbsp; 
            <wbr> 
           </div> 
           <div>
             “实模式”下的内存访问通过段寄存器与偏移量构成，比如前面描述中常常出现的 
           </div> 
           <div>
             0x:0000:0x0001 就是一个实模式下的内存地址。分号前面的值表示段寄存器中的值，分号后 
           </div> 
           <div>
             面的值表示偏移量，实际物理地址的形成如下图所示： 
           </div> 
          </div> 
          <div> 
           <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s9.sinaimg.cn/orignal/6730a3aat7904b24e8fd8" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s9.sinaimg.cn/middle/6730a3aat7904b24e8fd8&amp;690" name="image_operate_39401330610751026" alt="操作系统引导探究" title="操作系统引导探究"></a> 
           <p></p> 
          </div> 
          <div>
            然而在保护模式下，内存地址却不是如上图所示的方法形成的。那么它又是怎样形成 
          </div> 
          <div>
            的呢？&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            4.2 保护模式下的内存地址形成&nbsp; 
           <wbr> 
          </div> 
          <div>
            保护模式下内存地址就复杂多了， 我们首先要分清三个概念：逻辑地址、线性地址与 
          </div> 
          <div>
            物理地址。物理地址很好理解，逻辑地址也好理解，就是程序所使用的地址。那么什么是线 
          </div> 
          <div>
            性地址呢？&nbsp; 
           <wbr> 
          </div> 
          <div>
            其实如果不使用分页机制的话，线性地址就是物理地址，它与物理地址是一一对应的， 
          </div> 
          <div>
            线性地址 0，也就是物理地址 0。但我们知道，32位的 CPU拥有 32 根地址线，也就是可以 
          </div> 
          <div>
            访问：&nbsp; 
           <wbr> 
          </div> 
          <div>
            32 
          </div> 
          <div>
            2 &nbsp; 
           <wbr>= 
           <br> &nbsp; 
           <wbr>4GB&nbsp; 
           <wbr> 
          </div> 
          <div>
            的内存空间，这实在是一个太大的空间了！现在很少有机器的物理内存能有这么大。那怎么 
          </div> 
          <div>
            +&nbsp; 
           <wbr> 
          </div> 
          <div>
            15 &nbsp; 
           <wbr>0&nbsp; 
           <wbr> 
          </div> 
          <div>
            段寄存器&nbsp; 
           <wbr> 
          </div> 
          <div>
            15 &nbsp; 
           <wbr>0&nbsp; 
           <wbr> 
          </div> 
          <div>
            偏移量&nbsp; 
           <wbr> 
          </div> 
          <div>
            左移 4 位&nbsp; 
           <wbr> 
          </div> 
          <div>
            19 &nbsp; 
           <wbr>0&nbsp; 
           <wbr> 
          </div> 
          <div>
            20 位的物理地址 在有限的物理空间中使用 4GB 的空间呢？人们把物理内存分成许多页，同样也把整个 4GB 
          </div> 
          <div>
            的线性地址空间分成大小相同的许多页。在线性地址空间中，当某些页被使用的时候，某些 
          </div> 
          <div>
            页可能没有被使用，操作系统可以让 CPU 将没有被使用的页调出物理内存（存放在磁盘的 
          </div> 
          <div>
            某个地方，以备需要的时候再次调入） ，而把需要使用的页调入，这样，虽然物理内存空间 
          </div> 
          <div>
            有限，但也几乎可以使用所有的线性地址空间了。这就称为从线性地址到物理地址的映射， 
          </div> 
          <div>
            这是一个多对一的映射，也就是说多个线性空间中的页对应一个物理空间中的页，希望下面 
          </div> 
          <div>
            一幅图能有助于你理解这样的分页机制。&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s11.sinaimg.cn/orignal/6730a3aatba2efcf0010a" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s11.sinaimg.cn/middle/6730a3aatba2efcf0010a&amp;690" width="690" height="364" name="image_operate_67601330610786673" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            上面是一种最简单的映射方式，术语称作“直接相连”映射，它大约只能用来说明问 
          </div> 
          <div>
            题，而在一个实际的操作系统中通常是“全相联相连”映射，也就是说线性地址中的页可以 
          </div> 
          <div>
            是映射到物理地址中的任何一个页中，只要那块物理地址空间现在是空闲的。不过，通过上 
          </div> 
          <div>
            图也能说明问题，当线性地址中的页 5 需要被访问时，CPU 通过地址映射机制将其转换到 
          </div> 
          <div>
            物理地址，发现其对应物理地址中的页 1。于是 CPU 会产生一个所谓的缺页中断来通知操 
          </div> 
          <div>
            作系统进行处理，操作系统相应这个中断，并在中断服务程序中将物理地址页 1 中的内容放 
          </div> 
          <div>
            到磁盘上的一个地方（虚拟内存） ，然后将线性地址中的页 5 载入物理内存页 1 中。这里就 
          </div> 
          <div>
            当可以比较明显的区别什么是线性地址，什么是物理地址了。&nbsp; 
           <wbr> 
          </div> 
          <div>
            然而，当不使用分页机制的时候，线性地址就会被 CPU 当做物理地址来使用，线性地 
          </div> 
          <div>
            址会被直接放在 CPU 的地址信号线上。不过，在编写应用程序的时候，我们通常使用的却 
          </div> 
          <div>
            是另一种地址——逻辑地址， 从逻辑地址到线性地址也存在着与上述机制类似的一种映射机 
          </div> 
          <div>
            制，不过这个机制常常称为“段模式” ，它是由操作系统与 CPU硬件共同完成的。操作系统 
          </div> 
          <div>
            的任务就是分配映射表，而 CPU 硬件的任务就是按着映射表进行映射。而这样的映射表在 
          </div> 
          <div>
            操作系统编写中又称之为“描述符表” ，有两种重要的描述符表，一种是“全局描述符表 
          </div> 
          <div>
            （GDT） ” ，另一种是“局部描述符表（LDT） ” ，这两种表的用途不同，但它们的用法却是近 
          </div> 
          <div>
            似的，下面我们就来描述一下全局描述符表。&nbsp; 
           <wbr> 
          </div> 
          <div>
            说到表，学过数据结构的人都知道，其实它就是一种数据结构，全局描述符表也是一 
          </div> 
          <div>
            种数据结构，当这种结构放在一块连续的内存之中就称之为表了。表由表项组成，全局描述 
          </div> 
          <div>
            符表由它的表项“全局描述符”组成，其实单纯的术语就叫“描述符” ，只因为它放在全局 
          </div> 
          <div>
            描述符表中就成了全局描述符了。 这个描述符由 8 个字节组成， 下面我们就来看看它的结构： 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div> 
           <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s7.sinaimg.cn/orignal/6730a3aatba2f002803c6" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s7.sinaimg.cn/middle/6730a3aatba2f002803c6&amp;690" name="image_operate_65861330610854401" alt="操作系统引导探究" title="操作系统引导探究"></a> 
           <p></p> 
           <div>
             TYPE： &nbsp; 
            <wbr>表明此段的类型，4 位中的最高位被清 0 
            <br> 的时候表是它是数据段，相应的余下 
           </div> 
           <div>
             的三位，从左到右依次为 E、W、A，即数据段的 TYPE 为：0EWA。其中 E 表示向下增长 
           </div> 
           <div>
             位，置 1 时表示向下增长（这主要是在大小需要动态改变的堆栈段中使用，如果是向下增长 
           </div> 
           <div>
             的段，动态的改变段的大小限制，会让堆栈空间加到堆栈的底部。如果堆栈的大小不需要改 
           </div> 
           <div>
             变，那么这个段既可以是向下增长的段，也可以是非向下增长的段） ；W 表示可写位，置 1 
           </div> 
           <div>
             表示可写；A表示被访问位（如果 CPU访问了它，此位将会被置 1） 。&nbsp; 
            <wbr> 
           </div> 
           <div>
             4 位中的最高位被置 1 时表示它是代码段，相应的余下的三位，从左到右依次为 C、Ｒ、 
           </div> 
           <div>
             Ａ，即代码段的 TYPE 为：1CRA。其中 C 是表明此代码段是否是一致代码段，如果 C 被置 
           </div> 
           <div>
             1，表明此是一致代码段。一致代码段主要是用于特权级访问控制，这在以后的实验报告中 
           </div> 
           <div>
             会详细论述；R 表明此段是否可读，置 1 
            <br> 表示可读；A表示被访问位，这与前述一样。&nbsp; 
            <wbr> 
           </div> 
           <div>
             S：为 1 时表示这是一个代码段或数据段描述符，为 0 时表示这是一个系统段描述符。 
           </div> 
           <div>
             系统段描述符又称为特殊段描述符， 包括： 局部描述符表 （LDT） 描述符， 任务状态段 （TSS） 
           </div> 
           <div>
             描述符，调用门描述符，中断门描述符，陷阱门及任务门描述符等。&nbsp; 
            <wbr> 
           </div> 
           <div>
             DPL：表示特权级，从 00~11，共 0，1，2，3 四个特权级&nbsp; 
            <wbr> 
           </div> 
           <div>
             P：为 0 是表示此描述符无效，不能被使用&nbsp; 
            <wbr> 
           </div> 
           <div>
             AVL：留给程序员随便用的&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr>&nbsp; 
            <wbr>段基址的 0~24 
            <br> &nbsp; 
            <wbr>位 &nbsp; 
            <wbr>段限的 
            <br> 0~15位&nbsp; 
            <wbr> 
           </div> 
           <div>
             7 &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 6 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr>5 &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr>4 &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 3 &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr>2 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr>1 &nbsp; 
            <wbr> &nbsp; 
            <wbr> 
            <br> &nbsp; 
            <wbr> &nbsp; 
            <wbr> 0&nbsp; 
            <wbr> 
           </div> 
           <div>
             TYPE：4 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             S标志：1 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             DPL 标志：2 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             P标志：1 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             段限的 16~19 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             AVL 标志：1 位 
           </div> 
           <div>
             0：1 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             D/B 标志：1位&nbsp; 
            <wbr> 
           </div> 
           <div>
             G标志：1 位&nbsp; 
            <wbr> 
           </div> 
           <div>
             基址的 24~31 位 D/B：为 0 的时候表示它是一个 16 位的段，为 1时表示它是一个 32 
            <br> 位的段&nbsp; 
            <wbr> 
           </div> 
           <div>
             G：为 0 时，表示段限的单位是 1 字节，为 1 时表示段限的单位是 4KB，并且段偏移量 
           </div> 
           <div>
             的最低 12 位将不被检测是否在段限之中。 （这一点现在可能不好理解，但我下面马上会解 
           </div> 
           <div>
             释） 。&nbsp; 
            <wbr> 
           </div> 
           <div>
             这里面有两个部份比较有意思，一个是“基址” ，一个是“段限” 。基址应当比较好理 
           </div> 
           <div>
             解，它给出的是一个段在线性内存中的起始地址，对于“段限” ，顾名思义，就是段大小的 
           </div> 
           <div>
             限制。不过它有点特别，对于一个段的最大可访问的地址 CPU 是通过下面的公式计算得到 
           </div> 
           <div>
             的：&nbsp; 
            <wbr> 
           </div> 
           <div>
             &nbsp; 
            <wbr>&nbsp; 
            <wbr>段基址 + 段限值 * 
            <br> &nbsp; 
            <wbr>段限单位 = &nbsp; 
            <wbr>此段最大可访问地址 
            <br> &nbsp; 
            <wbr> 
           </div> 
           <div>
             如果一个偏移地址大于了此段最大可访问地址的话，CPU 就将产生一个错误中断，这 
           </div> 
           <div>
             样一来就可以防止一个程序非法访问另一个程序的内存空间， 这对内存起到了保护作用， “保 
           </div> 
           <div>
             护模式”由此得名。&nbsp; 
            <wbr> 
           </div> 
           <div>
             所以，如果段限是 0，那么此段最大可访问地址就是段的基址，因此，当段限单位为一 
           </div> 
           <div>
             字节时，此段的段大小就是 1 字节；当段限单位为 4KB 时，因为 CPU将不检测偏移量的最 
           </div> 
           <div>
             低 12 位，而这 12 位最大可能为 0xFFF，因此，这时此段的可访问范围就为 
            <br> 4KB，所以：&nbsp; 
            <wbr> 
           </div> 
           <div>
             （段限值 + 1）* &nbsp; 
            <wbr>段限单位 = 
            <br> &nbsp; 
            <wbr>此段大小&nbsp; 
            <wbr> 
           </div> 
           <div>
             现在我们可以正式开始描述在保护模式下段模式是怎样访问内存的了。这里之所以要 
           </div> 
           <div>
             强调“段模式”是因为在保护模式下还有一种前面叙述过的内存访问模式——页模式，它负 
           </div> 
           <div>
             责将线性地址再按某种映射转换为物理地址。 “页模式”也是基于段模式的，在不使用它的 
           </div> 
           <div>
             情况下，线性地址会被直接放到地址线上当做物理地址使用。 “段模式”是不可避免的，所 
           </div> 
           <div>
             谓的 “纯页模式” 只是将整个线性地址当作一个整段， 没有什么方法可以真正绕过 “段模式” ， 
           </div> 
           <div>
             因为这是由 CPU内存访问机制所规定的。本篇只描述段模式。&nbsp; 
            <wbr> 
           </div> 
           <div>
             我们已经知道从程序使用的逻辑地址到线性地址的映射是通过“描述符”来完成的， 
           </div> 
           <div>
             而“描述符”又是放在描述符表中的，那么，一个描述表中有许多描述符，到底选用哪一个 
           </div> 
           <div>
             描述符呢？这就由一个索引来决定，这个索引将指出是表中的第几个描述符，这个索引有一 
           </div> 
           <div>
             个专门的术语来描述，常常称它为“段选择子” 。 “段选择子”由 2 个字节共 16 位组成，下 
           </div> 
           <div>
             面，我们就来看看它提供了哪些信息： 
           </div> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s3.sinaimg.cn/orignal/6730a3aatba2f0264b9c2" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s3.sinaimg.cn/middle/6730a3aatba2f0264b9c2&amp;690" name="image_operate_60951330610940765" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            其中：&nbsp; 
           <wbr> 
          </div> 
          <div>
            RPL：指示出特权级，00~11，共 0、1、2、3 
           <br> 四个特权级，与前述一样。&nbsp; 
           <wbr> 
          </div> 
          <div>
            TI： 为 0 时表明这是个用于全局描述符表的选择子， 为 1 时表明用于局部描述符表。 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            索引值：用来指示表中第几个描述符。索引值共有 13 位，因此，每张描述符表共 
          </div> 
          <div>
            可有 8K个表项，而一个表项如前所述，占 8 个字节，因此一张描述符表最大可达 
           <br> 64K。&nbsp; 
           <wbr> 
          </div> 
          <div>
            不知道大家是否注意到这样一个事实，如果将“段选择子”的最后 3位置 0，这整个段 
          </div> 
          <div>
            选择子其实就是一个描述符在描述符表中的偏移量！这里我们可以发现 Intel 的工程师在设 
          </div> 
          <div>
            计的时候真的是非常精巧，如此的安排，可以使选取一个描述符的速度极大加快，因为将一 
          </div> 
          <div>
            个段选择子最后 3 位清零后与描述符表的基址相加，就立即可以得到一个描述符的物理地 
          </div> 
          <div>
            15 &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>3 &nbsp; 
           <wbr>2 &nbsp; 
           <wbr> 1 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            索引值 &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> TI &nbsp; 
           <wbr> RPL 
           <br> 址，通过这个地址就可以直接得到一个描述符。那么这个描述符表的基址又是放在哪儿的 
          </div> 
          <div>
            呢？&nbsp; 
           <wbr> 
          </div> 
          <div>
            所为描述符表的基址也就是此描述符表在内存中的起始地址，也即表中第一个描述符 
          </div> 
          <div>
            所在的内存地址，系统中用两个特殊的寄存器来存放，一个用于存放全局描述符表的基址， 
          </div> 
          <div>
            称之为“全局描述符表寄存器（GDTR） ” ，另一个用来存放局部描述符表的基址，称之为“局 
          </div> 
          <div>
            部描述符表寄存器（LDTR） ” ，它们的结构如下图所示： 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s2.sinaimg.cn/orignal/6730a3aagba2f06c14e51" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s2.sinaimg.cn/middle/6730a3aagba2f06c14e51&amp;690" name="image_operate_91851330610985562" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            其中表限也即表的大小限制，它的使用与前面所描述的段限是类似的，因此，这里就不 
          </div> 
          <div>
            在描述了。&nbsp; 
           <wbr> 
          </div> 
          <div>
            在保护模式下，以前实模式下的段寄存器还是有用的，不过它不再用来存放段的基址， 
          </div> 
          <div>
            而是用来存放“段选择子” ，它的名字也变成了“段选择子寄存器” ，在访问内存的时候，我 
          </div> 
          <div>
            们需要给出的是“段选择子” ，而不是段基址了。&nbsp; 
           <wbr> 
          </div> 
          <div>
            比如，我现在想使用全局描述符表中第二个表项，即其中的第二个“段描述符” ，这个 
          </div> 
          <div>
            “段选择子”就需按如下的方式构成：&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> RPL：00，因为我们现在是在写操作系统，工作在 0 特权级&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> TI：0，我们使用全局描述符&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
           <br> 索引值：1，我们使用第二个全局描述符，第一个全局描述符编号为 0，第二个为 1&nbsp; 
           <wbr> 
          </div> 
          <div>
            因此，我们的“段选择子”为：0000 0000 0000 10000，也即 0x0008，因此，对于 
          </div> 
          <div>
            0x0008:0x0000 
           <br> &nbsp; 
           <wbr>这样一个逻辑地址，在保护模式下就应看成是使用全局描述符段中第二个描 
          </div> 
          <div>
            述符所描述的段，并且偏移量为 0的内存地址。&nbsp; 
           <wbr> 
          </div> 
          <div>
            这个逻辑地址的线性地址是怎样形成的呢？请看如下的图示：&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s7.sinaimg.cn/orignal/6730a3aatf45d65e31366" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s7.sinaimg.cn/middle/6730a3aatf45d65e31366&amp;690" name="image_operate_28141330611019322" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            相信， 从上图中你可以清楚的看出一个逻辑地址是怎样转换为一个32位的线性地址的。 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            五、pyos 引导程序编写&nbsp; 
           <wbr> 
          </div> 
          <div>
            pyos 是一个正在编写中的操作系统，是一个实验中的项目，关于编写的目的与动机我 
          </div> 
          <div>
            已在前言中谈论过了，这里，仅就此篇所讲述的内容，谈谈 pyos 引导程序的编写，在编写 
          </div> 
          <div>
            期间参考了 linux 0.11 &nbsp; 
           <wbr>内核引导程序的编写，不过 pyos 并不是基于 
           <br> linux的，就它们的引导 
          </div> 
          <div>
            程序之间也有许多不一样的地方。下面我们先来看看 
           <br> pyos的整个引导区的内存安排：&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s5.sinaimg.cn/orignal/6730a3aatba2f0cec20b4" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s5.sinaimg.cn/middle/6730a3aatba2f0cec20b4&amp;690" width="440" height="517" name="image_operate_89781330611260593" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            上面一幅图就是 pyos 的内存安排图，也是引导程序流程图，pyos 是两级引导系统，首 
          </div> 
          <div>
            先是boot被BIOS读入， 随后boot读入setup， setup读入system程序到暂存区， 
           <br> 然后把system 
          </div> 
          <div>
            程序搬到内存顶部，并建立指向 system程序所在段的段描述符及建立 GDT，然后切换 CPU 
          </div> 
          <div>
            到保护模式， 最后跳转到 system程序中执行， 至此 pyos 系统引导完毕， system程序将是 
           <br> pyos 
          </div> 
          <div>
            真正的系统内核。图中的数据存放区用来存发在 boot、setup、pyos 三者程序间需要传递的 
          </div> 
          <div>
            参数。&nbsp; 
           <wbr> 
          </div> 
          <div>
            之所以做成两级引导主要是考虑到以后扩展时的方便，各程序间都差不多是独立的， 
          </div> 
          <div>
            以后可以重写 boot 或者 setup 以提供更多可选择的引导方式。System 
           <br> 程序暂存区是因为如前所述，不能直接将数据读到中断向量表中覆盖原中断向量表，当数据读完之后，不再调用 
          </div> 
          <div>
            中断了，才将程序搬到内存顶部覆盖原中断向量表，对于保护模式下的中断向量表，将由 
          </div> 
          <div>
            system程序负责建立，交给 system使用的是一块完整而干净的内存。&nbsp; 
           <wbr> 
          </div> 
          <div>
            对于 pyos 进程内存安排，准备参照 Linux 0.11 
           <br> 进行，内存安排如下：&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s4.sinaimg.cn/orignal/6730a3aagba2f1c475143" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s4.sinaimg.cn/middle/6730a3aagba2f1c475143&amp;690" name="image_operate_49061330611339499" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            一个进程享有 64M 空间，4GB / 64M = 64，也即系统最大进程数为 64。因此一个段的 
          </div> 
          <div>
            段限为：64MB，每个进程占用全局描术符表中两个描述符，一个为数据段描述符，一个为 
          </div> 
          <div>
            代码段描述符，段限均为 64MB。&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            六、pyos 引导程序源代码&nbsp; 
           <wbr> 
          </div> 
          <div>
            下面将提供 pyos 引导程序的全部源代码，因为 system还未完全完成，因此这里只是让 
          </div> 
          <div>
            它简单的打印一个字符以示引导工作完成，代码中已有较为详尽的注释，如果仍有不太清楚 
          </div> 
          <div>
            的地方，可以去 http://purec.binghua.com（纯 C 论坛）操作系统实验专区，查看 
           <br> pyos以前的 
          </div> 
          <div>
            实验报告，上面有非常详尽的注释及相关原理说明，并详细描述了怎样编译及实验。&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div></div> 
         <div> 
          <div>
            ;文件名: boot.asm&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;作 &nbsp; 
           <wbr>者; 谢煜波&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;Emailv: xieyubo@126.com&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;内存分配如下&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;内存起始地址为 0x90000&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;最大结束地址为 0x9ffff&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;最大共 64KB &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
          </div> 
          <div>
            ;所有启动代码在一个段内，方便调用&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;启动代码共分两部分，一是boot，一是setup，这点照搬linux 
           <br> 0.11的设计&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;但与其不同的是，boot不会将自己搬到0x90000处，而直接跳到 
           <br> 0x90100处运行&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;0x90000~0x900ff (256B) 
           <br> 系统保留来存放一些从BIOS中取出的关键数据&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;0x90100~0x904ff 
           <br> (1KB)：此处开始存放setup，setup大小为1KB&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            [BITS 16] &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;编译成16位的指令&nbsp; 
           <wbr> 
          </div> 
          <div>
            [ORG 0x7C00]&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;——————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div></div> 
         <div> 
          <div>
            jmp Main&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;——————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;数据定义&nbsp; 
           <wbr> 
          </div> 
          <div>
            MSG &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>db &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> “Loading pyos …” 
           <br> &nbsp; 
           <wbr>;输出信息&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> db &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 13 , 10 , 0 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> ;13表示回车，10表示换行，&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;0表示字符串结束&nbsp; 
           <wbr> 
          </div> 
          <div>
            BOOTSEG &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>equ &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>0x0000 &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>;boot所在的段基址 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            SETUPSEG &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> equ 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x9000 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;setup所在的段基址&nbsp; 
           <wbr> 
          </div> 
          <div>
            SETUPOFFSET &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>equ &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0100 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;setup所在的偏移量&nbsp; 
           <wbr> 
          </div> 
          <div>
            SETUPSIZE &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>equ 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>1024 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;setup的大小，必须是512的倍数&nbsp; 
           <wbr> 
          </div> 
          <div>
            BOOTDRIVER &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> db &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 0 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> ;保存启动的驱动器号&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;——————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            ShowMessage: &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;以下程序行为显示输出信息&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>ah , 0x0e 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;设置显示模式&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>bh , 0x00 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;设置页码&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>bl , 0x07 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;设置字体属性&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>.nextchar:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>lodsb&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>or &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> al , 
           <br> al&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jz &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> .return&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>int &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>0x10&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jmp &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>.nextchar&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>.return: 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>ret&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;——————————————————————————————- 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            Main: &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>[BOOTDRIVER] , dl &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;得到启动的驱动器号&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;以下程序设置数据段&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>ax , 
           <br> BOOTSEG&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>ds , 
           <br> ax&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>si , MSG 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>call &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ShowMessage 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;显示信息&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;读入setup&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;从磁盘的第二个扇区读到0x90100处&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>.readfloopy:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>ax , 
           <br> SETUPSEG &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>es , 
           <br> ax&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>bx , 
           <br> SETUPOFFSET&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>ah , 
           <br> 2&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dl , 
           <br> [BOOTDRIVER]&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>ch , 
           <br> 0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>cl , 
           <br> 2&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>al , 
           <br> SETUPSIZE / 512 &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ;读入扇区数( 2个共1KB 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>int &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>0x13&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jc &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> .readfloopy&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;把启动驱动器号保存在0x90000处&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> al , 
           <br> [BOOTDRIVER]&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> [0] , 
           <br> al&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;跳转&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jmp &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> SETUPSEG : 
           <br> SETUPOFFSET&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;————————————————————————— 
          </div> 
          <div>
            times 510-($-$$) db 0&nbsp; 
           <wbr> 
          </div> 
          <div>
            db 0x55&nbsp; 
           <wbr> 
          </div> 
          <div>
            db 0xAA&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div></div> 
         <div> 
          <div>
            ;文件名: setup.asm&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;作 &nbsp; 
           <wbr>者; 谢煜波&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;Emailv: xieyubo@126.com&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            ;此setup程序完成boot未完成的启动工作，&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;包括从BIOS中读出系统信息存放在指定位置&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;初始化GDT,LDT表，完成从保护模式到实模式的转换&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;实模式的代码也由此程序读入&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            [BITS 16] &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            [ORG 0x0100]&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            jmp &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> Main&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            SETUPSEG &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>equ &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> 0x9000&nbsp; 
           <wbr> 
          </div> 
          <div>
            SETUPOFFSET &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> equ &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 0x0100&nbsp; 
           <wbr> 
          </div> 
          <div>
            SETUPSIZE &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> equ 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 1024 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;setup的大小1KB,必须是 512 的倍数&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            SYSTEMSEG &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> equ 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 0x0000 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            SYSTEMOFFSET &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>equ &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            SYSTEMSIZE &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>equ 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 1024 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;SYSTEM的大小1KB,此值必须是 512 的倍 
          </div> 
          <div>
            数&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;实际值可以不符&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            ;下面定义临时GDT表的描述符&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;总共定义三个段，一个空段由intel保留，一个代码段，一个数据段&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div></div> 
         <div> 
          <div>
            gdt_addr:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x7fff &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;GDT表的大小&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>gdt &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> ;GDT表的位置&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0009&nbsp; 
           <wbr> 
          </div> 
          <div>
            gdt:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>gdt_null:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>gdt_system_code:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x3fff &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;段限(0x3fff+1)*4KB=64KB &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x9a00&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x00c0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>gdt_system_data:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x3fff&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x0000&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x9200&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>dw &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>0x00c0 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;等待键盘控制器空闲的子程序&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            Empty_8042: &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>in &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>al , 0x64&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>test &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>al , 
           <br> 0x2&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jnz &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> Empty_8042&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>ret&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;————————————————————————————- 
          </div> 
          <div>
            Main: &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;初始化寄存器，因为Bios中断及call会用到堆栈或ss寄存器&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;在CPU启动或复位时是由BIOS初始化的，而现在进行了段转移，需要我们重新设置&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ax , 
           <br> SETUPSEG&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ds , 
           <br> ax&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> es , ax 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ss , ax 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> sp , 
           <br> 0xffff&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;从BIOS中到底应读出哪些有用信息，现在还不确定，因此暂时跳过此功能块&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;———————————————–&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;0x90000 (1B): 
           <br> 保存启动驱动器号，由boot程序存入&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;————————————————————————–&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;下面读入system到setup程序的后面&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;因为0x00000现在是放BIOS中断的地方，因此还不能直接将system读到0x00000处，&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;否则将无法调用BIOS中断读入磁盘&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>.readfloopy:&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ax , 
           <br> SETUPSEG &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> es , 
           <br> ax&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> bx , 
           <br> SETUPOFFSET + SETUPSIZE&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ah , 
           <br> 2&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> dl , 
           <br> [0]&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ch , 
           <br> 0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> cl , 1 + 1 
           <br> + SETUPSIZE / 512 &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;system所在的启始扇区&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;第一个1是指从1开始记数&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> ;第二个1是boot所占扇区数&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> al , 
           <br> SYSTEMSIZE / 512 &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> ;读入扇区数( 2个扇区共1KB )&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>int &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> 0x13&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jc &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>.readfloopy&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;下面将读入的system搬移到0x00000位置 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>cld &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> si , 
           <br> SETUPOFFSET + SETUPSIZE&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ax , 
           <br> SYSTEMSEG&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> es , 
           <br> ax&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> di , 
           <br> SYSTEMOFFSET&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> cx , 
           <br> SYSTEMSIZE / 4&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>rep movsd 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;下面开始为进入保护模式而进行初始化工作&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>cli &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ;关中断&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>lgdt &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>[gdt_addr] 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>;载入gdt的描述符&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;下面打开A20地址线&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>call &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>Empty_8042&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> al , 0xd1 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>out &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 0x64 , 
           <br> al&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>call &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>Empty_8042&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> al , 
           <br> 0xdf&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>out &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 0x60 , 
           <br> al&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>call &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>Empty_8042&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div></div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;下面设置进入32位保护模式运行&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> eax , 
           <br> cr0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>or &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>eax , 1&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> cr0 , eax 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jmp dword 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 0x8:0x0 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            ;————————————————————————————-&nbsp; 
           <wbr> 
          </div> 
          <div>
            times 1024-($-$$) db 0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            ;文件名: kernel.asm&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;作 &nbsp; 
           <wbr>者; 谢煜波&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;Emailv: xieyubo@126.com&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
          </div> 
          <div>
            [BITS 32] &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            [ORG 0x0]&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;——————————————————————————————&nbsp; 
           <wbr> 
          </div> 
          <div>
            jmp Main&nbsp; 
           <wbr> 
          </div> 
          <div>
            ;—————————————————————————————— 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            Main: &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>;设置寄存器 &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ax , 
           <br> 0x10&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> ds , 
           <br> ax&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> cl , 
           <br> ‘1’&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> [0xb8000] 
           <br> , cl&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> cl , 
           <br> 0x04&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>mov &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> [0xb8001] 
           <br> , cl&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr>&nbsp; 
           <wbr>jmp 
           <br> $&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <div>
            以上程序中有一个地方本篇及以前的实验报告中也未提到，这就是 A20地址线的问题， 
          </div> 
          <div>
            对于有关 A20 地址线的问题，在《Linux 0.11 
           <br> &nbsp; 
           <wbr>内核源代码完全注释》中有非常详细的描述， 
          </div> 
          <div>
            作者还列举了其它几种打开 A20 地址线的方法，并分析了可能存在的问题。这是一本非常 
          </div> 
          <div>
            好的书， 推荐大家阅读。 纯 C 论坛上 （http://purec.binghua.com） 可以下载本书的电子版 
           <br> （PDF 
          </div> 
          <div>
            格式） ，也可以在上面找到另外一些相关资源。&nbsp; 
           <wbr> 
          </div> 
          <div>
            下面就是运行时的截图，现在它只能引导，什么也干不了，希望下次它能多干一点~~&nbsp; 
           <wbr> 
          </div> 
         </div> 
         <div> 
          <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=6730a3aa01010dnj&amp;url=http://s3.sinaimg.cn/orignal/6730a3aatba2f27670ec2" target="_blank"><img src="http://simg.sinajs.cn/blog7style/images/common/sg_trans.gif" real_src="http://s3.sinaimg.cn/middle/6730a3aatba2f27670ec2&amp;690" width="690" height="405" name="image_operate_47321330611496324" alt="操作系统引导探究" title="操作系统引导探究"></a> 
          <p></p> 
          <div>
            参考资料&nbsp; 
           <wbr> 
          </div> 
          <div>
            1. &nbsp; 
           <wbr>《IA-32 Intel® Architecture Software 
           <br> Developer’s Manual Volume 3:System 
           <br> Programming&nbsp; 
           <wbr> 
          </div> 
          <div>
            Guide》 &nbsp; 
           <wbr>（Intel 2001）&nbsp; 
           <wbr> 
          </div> 
          <div>
            2. &nbsp; 
           <wbr>《Linux &nbsp; 
           <wbr>内核 0.11 
           <br> &nbsp; 
           <wbr>完全注释》 （赵炯，2003）&nbsp; 
           <wbr> 
          </div> 
          <div>
            《计算机组成原理》 （唐朔飞，高等教育出版社）&nbsp; 
           <wbr> 
          </div> 
         </div> 
        </div>
       </div>
       <!-- .entry-content --> 
       <!-- .entry-meta --> 
      </article>
      <!-- #post-218 --> 
      <!-- #comments --> 
     </div>
     <!-- #content --> 
    </div>
    <!-- #primary --> 
    <!-- #secondary .widget-area --> 
   </div>
   <!-- #main --> 
   <!-- #colophon --> 
  </div>
  <!-- #page -->   
  <!-- JiaThis Button BEGIN -->  
  <!-- JiaThis Button END -->   
 </body>
</html>