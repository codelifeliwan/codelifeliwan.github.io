<!doctype html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN">
 <!--<![endif]-->
 <head>      
  <link rel="stylesheet" type="text/css" media="all" href="stylesheets/style.css">     
  <link rel="stylesheet" id="codebox-css" href="stylesheets/codebox.css" type="text/css" media="screen">             
 </head> 
 <body class="single single-post postid-207 single-format-standard content-sidebar"> 
  <div id="page" class="hfeed"> 
   <header id="branding" role="banner"> 
    <hgroup> 
     <h1 id="site-title"><span><a href="http://codelifeliwan.github.io/" title="Code_Life_LiWan" rel="home">Code_Life_LiWan</a></span></h1> 
     <h2 id="site-description">My heart will go on and on…</h2> 
    </hgroup>  
    <!-- #access --> 
   </header>
   <!-- #branding --> 
   <div id="main" class="clearfix"> 
    <div id="primary"> 
     <div id="content" role="main"> 
      <!-- #nav-single --> 
      <article id="post-207" class="post-207 post type-post status-publish format-standard hentry category-professional_exchanges tag-reserved"> 
       <header class="entry-header"> 
        <h1 class="entry-title">[转载]Mysql参数优化</h1> 
        <div class="entry-meta"> 
         <span class="sep">Posted on </span>
         <a href="http://codelifeliwan.github.io/?p=207" title="下午 6:30" rel="bookmark"><time class="entry-date" datetime="2011-11-03T18:30:45+00:00" pubdate>3 十一月, 2011</time></a>
         <span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codelifeliwan.github.io/?author=1" title="View all posts by wanli" rel="author">wanli</a></span></span> 
         <span class="sep"> — </span> 
         <span class="comments-link"> <a href="http://codelifeliwan.github.io/?p=207#respond" title="Comment on [转载]Mysql参数优化">No Comments ↓</a> </span> 
        </div>
        <!-- .entry-meta --> 
       </header>
       <!-- .entry-header --> 
       <div class="entry-content">
        <div class="entry-content"> 
         <p> 谢啦！ </p> 
         <div class="blogzz_abstract borderc" style="padding-top:15px;margin:20px 0; border:none; border-top:1px dotted #ccc;"> 
          <div class="blogzz_ainfo" style="margin-bottom:12px;"> 
           <span style="margin-right:25px;"><strong>原文地址：</strong><a target="_blank" href="http://blog.sina.com.cn/s/blog_5357c0af01011a2z.html" title="Mysql参数优化">Mysql参数优化</a></span> 
           <span><strong>作者：</strong><a href="http://blog.sina.com.cn/u/1398259887" title="哥本草根" target="_blank">哥本草根</a></span> 
          </div> 
          <div class="blogzz_acon"> 
           <div> 
            <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: rgb(109, 109, 109); line-height: 26px; font-size: 12px; background-color: rgb(255, 255, 255);"> <font face="'Times New Roman'"><strong><span style="font-size: 20px;">Mysql参数优化</span><br></strong>MySQL运行参数，修改/etc/my.cnf文件调整mysql运行参数重启MySQL后生效，在MySQL4版本以后，一部分内部变量可以在MySQL运行时设置，不过重启MySQL就失效了。</font></p> 
            <font face="'Times New Roman'"> <p>mysqld程序–目录和文件<br> basedir&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>= path&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> #<br> 使用给定目录作为根目录(安装目录)。<br> datadir&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>= path&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> #<br> 从给定目录读取数据库文件。<br> pid-file&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr>=<br> filename&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr># 为mysqld程序指定一个存放进程ID的文件(仅适用于UNIX/Linux系统);</p> <p>[mysqld]&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr><br> socket&nbsp;<wbr>= /tmp/mysql.sock&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr>#<br> 为MySQL客户程序与服务器之间的本地通信指定一个套接字文件(Linux下默认是/var/lib/mysql/mysql.sock文件)</p> <p>port&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> =<br> 3306&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr># 指定MsSQL侦听的端口<br> key_buffer&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr> = 384M&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>#<br> key_buffer是用于索引块的缓冲区大小，增加它可得到更好处理的索引(对所有读和多重写)。<br> &nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr><br> 索引块是缓冲的并且被所有的线程共享，key_buffer的大小视内存大小而定。<br> table_cache&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>= 512&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> #<br> 为所有线程打开表的数量。增加该值能增加mysqld要求的文件描述符的数量。可以避免频繁的打开数据表产生的开销<br> sort_buffer_size = 2M&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr>#<br> 每个需要进行排序的线程分配该大小的一个缓冲区。增加这值加速ORDER BY或GROUP BY操作。<br> &nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr><br> 注意：该参数对应的分配内存是每连接独占！如果有100个连接，那么实际分配的总共排序缓冲区大小为100×6=600MB</p> <p>read_buffer_size = 2M&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr>#<br> 读查询操作所能使用的缓冲区大小。和sort_buffer_size一样，该参数对应的分配内存也是每连接独享。<br> query_cache_size = 32M&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> #<br> 指定MySQL查询结果缓冲区的大小<br> read_rnd_buffer_size&nbsp;<wbr> &nbsp;<wbr> = 8M #<br> 改参数在使用行指针排序之后，随机读用的。<br> myisam_sort_buffer_size =64M # MyISAM表发生变化时重新排序所需的缓冲<br> thread_concurrency&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>=<br> 8&nbsp;<wbr>&nbsp;<wbr>#<br> 最大并发线程数，取值为服务器逻辑CPU数量×2，如果CPU支持H.T超线程，再×2<br> thread_cache&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>=<br> 8&nbsp;<wbr>&nbsp;<wbr># #缓存可重用的线程数<br> skip-locking&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr>#<br> 避免MySQL的外部锁定，减少出错几率增强稳定性。<br> [mysqldump]<br> max_allowed_packet&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>=16M #<br> 服务器和客户端之间最大能发送的可能信息包</p> <p>[myisamchk]<br> key_buffer&nbsp;<wbr> &nbsp;<wbr>= 256M<br> sort_buffer&nbsp;<wbr>&nbsp;<wbr>= 256M<br> read_buffer&nbsp;<wbr>&nbsp;<wbr>= 2M<br> write_buffer = 2M</p> <p>其他可选参数：<br> back_log = 384<br> &nbsp;<wbr> &nbsp;<wbr> 指定MySQL可能的连接数量。<br> &nbsp;<wbr> &nbsp;<wbr><br> 当MySQL主线程在很短时间内接收到非常多的连接请求，该参数生效，主线程花费很短时间检查连接并且启动一个新线程。<br> &nbsp;<wbr> &nbsp;<wbr><br> back_log参数的值指出在MySQL暂时停止响应新请求之前的短时间内多少个请求可以被存在堆栈中。<br> &nbsp;<wbr> &nbsp;<wbr><br> 如果系统在一个短时间内有很多连接，则需要增大该参数的值，该参数值指定到来的TCP/IP连接的侦听队列的大小。<br> &nbsp;<wbr> &nbsp;<wbr><br> 试图设定back_log高于你的操作系统的限制将是无效的。默认值为50。对于Linux系统推荐设置为小于512的整数。<br> max_connections = n<br> &nbsp;<wbr> &nbsp;<wbr><br> MySQL服务器同时处理的数据库连接的最大数量(默认设置是100)。超过限制后会报 Too many connections<br> 错误<br> key_buffer_size = n<br> &nbsp;<wbr> &nbsp;<wbr><br> 用来存放索引区块的RMA值(默认设置是8M)，增加它可得到更好处理的索引(对所有读和多重写)<br> record_buffer：&nbsp;<wbr></p> <p>每个进行一个顺序扫描的线程为其扫描的每张表分配这个大小的一个缓冲区。<br> &nbsp;<wbr> &nbsp;<wbr><br> 如果你做很多顺序扫描，你可能想要增加该值。默认数值是131072(128K)<br> wait_timeout：<br> &nbsp;<wbr> &nbsp;<wbr> 服务器在关闭它之前在一个连接上等待行动的秒数。<br> interactive_timeout：<br> &nbsp;<wbr> &nbsp;<wbr><br> 服务器在关闭它前在一个交互连接上等待行动的秒数。<br> &nbsp;<wbr> &nbsp;<wbr> 一个交互的客户被定义为对<br> mysql_real_connect()使用 CLIENT_INTERACTIVE 选项的客户。<br> &nbsp;<wbr> &nbsp;<wbr> 默认数值是28800，可以把它改为3600。<br> skip-name-resolve&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr> &nbsp;<wbr><br> 禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。<br> &nbsp;<wbr> &nbsp;<wbr><br> 但需要注意，如果开启该选项，则所有远程主机连接授权都要使用IP地址方式，否则MySQL将无法正常处理连接请求！<br> log-slow-queries = slow.log&nbsp;<wbr><br> &nbsp;<wbr> &nbsp;<wbr> 记录慢查询,然后对慢查询一一优化<br> skip-innodb<br> skip-bdb<br> &nbsp;<wbr> &nbsp;<wbr> 关闭不需要的表类型,如果你需要,就不要加上这个<br> &nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr><br> &nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr><br> # &gt; SHOW VARIABLES LIKE ‘%query_cache%';<br> # &gt; SHOW STATUS LIKE ‘Qcache%';<br> 如果Qcache_lowmem_prunes的值非常大，则表明经常出现缓冲不够的情况；<br> 如果Qcache_hits的值非常大，则表明查询缓冲使用非常频繁，如果该值较小反而会影响效率，那么可以考虑不用查询缓冲；<br> 如果Qcache_free_blocks的值非常大，则表明缓冲区中碎片很多。</p> <p> ##########################################<br> ######&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>max_allowed_packet&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>######<br> ##########################################<br> 通信信息包是发送至MySQL服务器的单个SQL语句，或发送至客户端的单一行。<br> 在MySQL 5.1服务器和客户端之间最大能发送的可能信息包为1GB。<br> 当MySQL客户端或mysqld服务器收到大于max_allowed_packet字节的信息包时，将发出“信息包过大”错误，并关闭连接。对于某些客户端，如果通信信息包过大，在执行查询期间，了能回遇到“丢失与MySQL服务器的连接”错误。&nbsp;<wbr></p> <p>客户端和服务器均有自己的max_allowed_packet变量，因此，如你打算处理大的信息包，必须增加客户端和服务器上的该变量。</p> <p>如果你正在使用mysql客户端程序，其max_allowed_packet变量的默认值为16MB。要想设置较大的值，可用下述方式启动mysql：</p> <p>mysql&gt; mysql –max_allowed_packet=32M<br> 它将信息包的大小设置为32MB。<br> 服务器的默认max_allowed_packet值为1MB。如果服务器需要处理大的查询，可增加该值（例如，如果准备处理大的BLOB列）。例如，要想将该设置为16MB，可采用下述方式启动服务器：</p> <p>mysql&gt; mysqld –max_allowed_packet=16M</p> <p>也能使用选项文件来设置max_allowed_packet。要想将服务器的该变量设置为16MB，可在选项文件中增加下行内容：</p> <p>[mysqld]<br> max_allowed_packet=16M<br> 增加该变量的值十分安全，这是因为仅当需要时才会分配额外内存。例如，仅当你发出长查询或mysqld必须返回大的结果行时mysqld才会分配更多内存。该变量之所以取较小默认值是一种预防措施，以捕获客户端和服务器之间的错误信息包，并确保不会因偶然使用大的信息包而导致内存溢出。</p> <p>如果你正是用大的BLOB值，而且未为mysqld授予为处理查询而访问足够内存的权限，也会遇到与大信息包有关的奇怪问题。如果怀疑出现了该情况，请尝试在mysqld_safe脚本开始增加ulimit<br> -d 256000，并重启mysqld。<br> ##########################################<br> #####&nbsp;<wbr><br> &nbsp;<wbr>MySQL怎样打开和关闭数据库表&nbsp;<wbr>&nbsp;<wbr>#####</p> <p>##########################################<br> table_cache,<br> max_connections和max_tmp_tables影响服务器保持打开的文件的最大数量。如果你增加这些值的一个或两个，你可以遇到你的操作系统每个进程打开文件描述符的数量上强加的限制。然而，你可以能在许多系统上增加该限制。请教你的OS文档找出如何做这些，因为改变限制的方法各系统有很大的不同。</p> <p>table_cache与max_connections有关。例如，对于200个打开的连接，你应该让一张表的缓冲至少有200 *<br> n，这里n是一个联结(join)中表的最大数量。<br> 打开表的缓存可以增加到一个table_cache的最大值（缺省为64；这可以用mysqld的-O<br> table_cache=#选项来改变）。一个表绝对不被关闭，除非当缓存满了并且另外一个线程试图打开一个表时或如果你使用mysqladmin<br> refresh或mysqladmin flush-tables。<br> 当表缓存满时，服务器使用下列过程找到一个缓存入口来使用：</p> </font> 
            <p><font face="'Times New Roman'">不是当前使用的表被释放，以最近最少使用（LRU）顺序。<br> 如果缓存满了并且没有表可以释放，但是一个新表需要打开，缓存必须临时被扩大。<br> 如果缓存处于一个临时扩大状态并且一个表从在用变为不在用状态，它被关闭并从缓存中释放。<br> 对每个并发存取打开一个表。这意味着，如果你让2个线程存取同一个表或在同一个查询中存取表两次(用AS)，表需要被打开两次。任何表的第一次打开占2个文件描述符；表的每一次额外使用仅占一个文件描述符。对于第一次打开的额外描述符用于索引文件；这个描述符在所有线程之间共享</font></p> 
            <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: rgb(109, 109, 109); line-height: 26px; font-size: 12px; background-color: rgb(255, 255, 255);"> <font face="'Times New Roman'">&nbsp;<wbr></font></p> 
            <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: rgb(109, 109, 109); line-height: 26px; font-size: 12px; background-color: rgb(255, 255, 255);"> <font face="'Times New Roman'">经典配置<br> 主机&nbsp;<wbr><br> [mysqld]<br> default-character-set=utf8<br> character-set-server=utf8<br> default-collation=utf8_unicode_ci</font></p> 
            <font face="'Times New Roman'"> <p> datadir=/db/mysql<br> socket=/var/lib/mysql/mysql.sock<br> user=mysql<br> # Default to using old password format for compatibility with mysql<br> 3.x<br> # clients (those using the mysqlclient10 compatibility<br> package).<br> old_passwords=1<br> innodb_data_home_dir=/db<br> default-table-type=INNODB<br> #Replication<br> log-bin = /var/log/mysql/mysql-bin.log<br> binlog-do-db=oxdb<br> server-id=1<br> #OS: tuning<br> table_cache = 1024<br> key_buffer = 256M<br> record_buffer = 16M<br> wait_timeout=800<br> connect_timeout=25<br> interactive_timeout=800<br> max_connections=500<br> sort_buffer = 128M<br> innodb_log_file_size = 50M<br> innodb_log_buffer_size = 8M<br> innodb_buffer_pool_size = 1300MB<br> innodb_thread_concurrency=50<br> innodb_flush_method=O_DSYNC<br> innodb_status_file = 1<br> innodb_flush_log_at_trx_commit = 0<br> innodb_autoextend_increment = 25M<br> skip-external-locking<br> innodb_table_locks=0</p> <p>max_allowed_packet=32M<br> tmp_table_size=96M<br> thread_concurrency=10<br> thread_cache_size=500</p> <p>#result set and query cache<br> query_cache_type = 0<br> query_cache_size = 0</p> <p>long_query_time = 1<br> log_slow_queries = /var/log/mysql/slow-queries.log</p> <p>[mysqld_safe]<br> log-error=/var/log/mysqld.log<br> pid-file=/var/run/mysqld/mysqld.pid</p> <p>从机<br> [mysqld]<br> datadir=/var/lib/mysql<br> socket=/var/lib/mysql/mysql.sock<br> user=mysql<br> # Default to using old password format for compatibility with mysql<br> 3.x<br> # clients (those using the mysqlclient10 compatibility<br> package).<br> old_passwords=1<br> innodb_data_home_dir=/pp<br> default-table-type=InnoDB</p> <p>###REPLICATION PROPERTIES####<br> server-id=2<br> master-host=10.0.0.1<br> master-user=replication<br> master-password=replication<br> master-connect-retry=60<br> replicate-do-table=ox.name<br> replicate-do-table=ox.User<br> #replicate-do-db=oxb<br> #replicate-ignore-db=oxb<br> #replicate-ignore-db=”oxb”<br> skip-slave-start<br> slave-skip-errors=1062</p> <p>log-bin = /var/log/mysqld/bin.log<br> log-bin-index = /var/log/mysqld/log-bin.index<br> log-error = /var/log/mysqld/error.log</p> <p>relay-log = /var/log/mysqld/relay.log<br> relay-log-info-file = /var/log/mysqld/relay-log.info<br> relay-log-index = /var/log/mysqld/relay-log.index</p> <p>###OS TUNNING####<br> default-character-set=utf8<br> character-set-server=utf8<br> default-collation=utf8_unicode_ci<br> default-table-type=INNODB<br> wait_timeout=800<br> connect_timeout=25<br> interactive_timeout=800<br> max_connections=50<br> sort_buffer = 28M<br> group_concat_max_len=65536<br> innodb_buffer_pool_size=200MB<br> innodb_additional_mem_pool_size=20M<br> innodb_log_file_size=128M<br> innodb_log_buffer_size=8M<br> innodb_thread_concurrency=500<br> innodb_flush_method=O_DSYNC<br> table_cache=800<br> innodb_status_file = 1<br> innodb_flush_log_at_trx_commit = 0<br> innodb_autoextend_increment = 25M<br> skip-external-locking<br> innodb_table_locks=0<br> max_allowed_packet=32M<br> tmp_table_size=96M<br> thread_concurrency=10<br> thread_cache_size=500</p> <p>long_query_time = 1<br> log_slow_queries = /var/log/mysqld/slow-queries.log</p> <p>[mysqld_safe]<br> log-error=/var/log/mysqld.log<br> pid-file=/var/run/mysqld/mysqld.pid</p> <p>普通$ cat /etc/my.cnf<br> [mysqld]</p> <p>default-character-set=utf8<br> character-set-server=utf8<br> default-collation=utf8_unicode_ci</p> <p>wait_timeout=6000<br> connect_timeout=25<br> interactive_timeout=6000</p> <p>datadir=/var/lib/mysql<br> socket=/var/lib/mysql/mysql.sock<br> # Default to using old password format for compatibility with mysql<br> 3.x<br> # clients (those using the mysqlclient10 compatibility<br> package).<br> old_passwords=1<br> max_allowed_packet=32M<br> max_connections=200<br> key_buffer&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr>&nbsp;<wbr>= 16M<br> thread_stack&nbsp;<wbr> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>= 256k<br> thread_cache_size&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> = 500<br> #thread_stack&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr>= 128K<br> #thread_cache_size&nbsp;<wbr><br> &nbsp;<wbr>&nbsp;<wbr> &nbsp;<wbr> = 8<br> sort_buffer = 128M<br> innodb_buffer_pool_size=300MB</p> <p>[mysql.server]<br> user=mysql<br> basedir=/var/lib</p> </font> 
            <p><font face="'Times New Roman'">[mysqld_safe]<br> log-error=/var/log/mysqld.log<br> pid-file=/var/run/mysqld/mysqld.pid</font></p> 
            <p style="margin-top: 0px; margin-right: 0px; margin-bottom: 1em; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px; color: rgb(109, 109, 109); line-height: 26px; font-size: 12px; background-color: rgb(255, 255, 255);"> <font face="'Times New Roman'">&nbsp;<wbr></font></p> 
            <div style="word-wrap: break-word; color: rgb(154, 154, 154); font-size: 12px; line-height: 18px; background-color: rgb(255, 255, 255);"> 
             <div style="word-wrap: break-word;"> 
              <table cellspacing="0" cellpadding="0" style="border-collapse: collapse; -webkit-border-horizontal-spacing: 0px; -webkit-border-vertical-spacing: 0px;"> 
               <tbody> 
                <tr> 
                 <td style="word-wrap: break-word; margin-top: 0px; margin-right: 0px; margin-bottom: 0px; margin-left: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; padding-left: 0px;"> <font face="'Times New Roman'">数据库有7G数据，随着数据的增大，现在每天出现一次崩溃。<br> mysqladmin processlist<br> 查询进程，发现locked进程超多，而且一直locked不会解锁，到最后整个mysql被locked进程占满，崩溃。<p></p> <p>是否和my.cnf里如下配置有关。</p> <p>根据网上资料，做了如下配置，效果不是很明显：<br> MySQL调优性能的系统变量</p> <p>(1)、back_log：<br> 要求 MySQL<br> 能有的连接数量。当主要MySQL线程在一个很短时间内得到非常多的连接请求，这就起作用，然后主线程花些时间(尽管很短)检查连接并且启动一个新线程。</p> <p>back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。只有如果期望在一个短时间内有很多连接，你需要增加它，换句话说，这值对到来的TCP/IP连接的侦听队列的大小。你的操作系统在这个队列大小上有它自己的限制。试图设定back_log高于你的操作系统的限制将是无效的。</p> <p>当你观察你的主机进程列表，发现大量 264084 | unauthenticated user | xxx.xxx.xxx.xxx |<br> NULL | Connect | NULL | login | NULL 的待连接进程时，就要加大 back_log<br> 的值了。默认数值是50，我把它改为500。</p> <p>(2)、interactive_timeout：<br> 服务器在关闭它前在一个交互连接上等待行动的秒数。一个交互的客户被定义为对 mysql_real_connect()使用<br> CLIENT_INTERACTIVE 选项的客户。 默认数值是28800，我把它改为7200。</p> <p>(3)、key_buffer_size：<br> 索引块是缓冲的并且被所有的线程共享。key_buffer_size是用于索引块的缓冲区大小，增加它可得到更好处理的索引(对所有读和多重写)，到你能负担得起那样多。如果你使它太大，系统将开始换页并且真的变慢了。默认数值是8388600(8M)，我的MySQL主机有2GB内存，所以我把它改为402649088(400MB)。</p> <p>(4)、max_connections：<br> 允许的同时客户的数量。增加该值增加 mysqld 要求的文件描述符的数量。这个数字应该增加，否则，你将经常看到 Too many<br> connections 错误。 默认数值是100，我把它改为1024 。</p> <p>(5)、record_buffer：<br> 每个进行一个顺序扫描的线程为其扫描的每张表分配这个大小的一个缓冲区。如果你做很多顺序扫描，你可能想要增加该值。默认数值是131072(128K)，我把它改为16773120<br> (16M)</p> <p>(6)、sort_buffer：<br> 每个需要进行排序的线程分配该大小的一个缓冲区。增加这值加速ORDER BY或GROUP<br> BY操作。默认数值是2097144(2M)，我把它改为 16777208 (16M)。</p> <p>(7)、table_cache：<br> 为所有线程打开表的数量。增加该值能增加mysqld要求的文件描述符的数量。MySQL对每个唯一打开的表需要2个文件描述符。默认数值是64，我把它改为512。</p> <p>(、thread_cache_size：<br> 可以复用的保存在中的线程的数量。如果有，新的线程从缓存中取得，当断开连接的时候如果有空间，客户的线置在缓存中。如果有很多新的线程，为了提高性能可以这个变量值。通过比较<br> Connections 和 Threads_created 状态的变量，可以看到这个变量的作用。我把它设置为 80。</p> </font><p><font face="'Times New Roman'">(10)、wait_timeout：<br> 服务器在关闭它之前在一个连接上等待行动的秒数。 默认数值是28800，我把它改为7200。<br> ——————————<br> zzfrom:</font></p></td> 
                </tr> 
               </tbody> 
              </table> 
              <p><a href="http://apps.hi.baidu.com/share/detail/30690829">http://apps.hi.baidu.com/share/detail/30690829</a></p> 
             </div> 
            </div> 
           </div> 
          </div> 
         </div> 
        </div>
       </div>
       <!-- .entry-content --> 
       <!-- .entry-meta --> 
      </article>
      <!-- #post-207 --> 
      <!-- #comments --> 
     </div>
     <!-- #content --> 
    </div>
    <!-- #primary --> 
    <!-- #secondary .widget-area --> 
   </div>
   <!-- #main --> 
   <!-- #colophon --> 
  </div>
  <!-- #page -->   
  <!-- JiaThis Button BEGIN -->  
  <!-- JiaThis Button END -->   
 </body>
</html>