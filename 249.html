<!doctype html>
<!--[if IE 6]>
<html id="ie6" lang="zh-CN">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="zh-CN">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="zh-CN">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="zh-CN">
 <!--<![endif]-->
 <head>      
  <link rel="stylesheet" type="text/css" media="all" href="stylesheets/style.css">     
  <link rel="stylesheet" id="codebox-css" href="stylesheets/codebox.css" type="text/css" media="screen">             
 </head> 
 <body class="single single-post postid-249 single-format-standard content-sidebar"> 
  <div id="page" class="hfeed"> 
   <header id="branding" role="banner"> 
    <hgroup> 
     <h1 id="site-title"><span><a href="http://codelifeliwan.github.io/" title="Code_Life_LiWan" rel="home">Code_Life_LiWan</a></span></h1> 
     <h2 id="site-description">My heart will go on and on…</h2> 
    </hgroup>  
    <!-- #access --> 
   </header>
   <!-- #branding --> 
   <div id="main" class="clearfix"> 
    <div id="primary"> 
     <div id="content" role="main"> 
      <!-- #nav-single --> 
      <article id="post-249" class="post-249 post type-post status-publish format-standard hentry category-professional_exchanges tag-linux"> 
       <header class="entry-header"> 
        <h1 class="entry-title">Linux内核编译</h1> 
        <div class="entry-meta"> 
         <span class="sep">Posted on </span>
         <a href="http://codelifeliwan.github.io/?p=249" title="下午 6:36" rel="bookmark"><time class="entry-date" datetime="2012-06-21T18:36:08+00:00" pubdate>21 六月, 2012</time></a>
         <span class="by-author"> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://codelifeliwan.github.io/?author=1" title="View all posts by wanli" rel="author">wanli</a></span></span> 
         <span class="sep"> — </span> 
         <span class="comments-link"> <a href="http://codelifeliwan.github.io/?p=249#respond" title="Comment on Linux内核编译">No Comments ↓</a> </span> 
        </div>
        <!-- .entry-meta --> 
       </header>
       <!-- .entry-header --> 
       <div class="entry-content">
        <div class="entry-content"> 
         <p> 本文来自百度文档。</p> 
         <div> 
          <div style="text-align: center;"> 
           <font style="font-size: 22px;"><b>&nbsp;<wbr>linux内核编译步骤<br> &nbsp;<wbr> &nbsp;<wbr><br> &nbsp;<wbr></b></font> 
          </div> 
          <div>
            对于linux新手来说，编译内核相对有一些难度，甚至不知道如何入手，我通过在网上收集这方面的资料,最终编译成功.现在&nbsp; 
           <wbr> 
          </div> 
          <div>
            我归纳了一下，写出这一篇还算比较详细的步骤，希望能对各位新手有一些&nbsp; 
           <wbr> 
          </div> 
          <div>
            帮助。&nbsp; 
           <wbr> 
          </div> 
          <div>
            1、 &nbsp; 
           <wbr>准备工作 
          </div> 
          <div>
            （1） &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> 整理出系统需要支持的硬件、文件系统类型以及网络协议等内容。 
          </div> 
          <div>
            （2） &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> 建议用命令uname –r 
           <br> 查看一下系统的版本号，如果你的系统版本与将要编译的内核版本一致，建议将/lib/modules下的内容备份，否则将来的make 
           <br> modules_install 步骤产生的文件会覆盖这个路径下的内容。 
          </div> 
          <div>
            （3） &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> A:下载并解压linux内核，建议从http://www.kernel.org/pub/linux/kernel/ 
           <br> 下载内核，因为安装系统时所安装的源代码默认情况下支持很多设备，这样给内核裁减增加了难度。以下假设你已经下载了内核的为linux-x-y-z.tar.gz。一般都将linux内核源代码放在/usr/src下，这里仍然遵守这个习惯，如果你的这个路径下已经存在这个版本的内核，建议将已有的改个名称。 
          </div> 
          <div></div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>B:如果内核已经安装（/usr/src/目录有linux子目录），跳过如果没有安装，在光驱中放入linux安装光盘，找到kernel-source-2.xx.xx.rpm文件（xx代表数字，表示内核的版本号）, 
           <br> 比如RedHat linux的RPMS目录是/RedHat/RPMS/目录，然后使用命令rpm -ivh 
           <br> kernel-source-2.xx.xx.rpm安装内核&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            2、清除从前编译内核时残留的.o 文件和不必要的关联 &nbsp; 
           <wbr> 
          </div> 
          <div>
            cd /usr/src/linux&nbsp; 
           <wbr> 
          </div> 
          <div>
            make mrproper&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> 确保源代码目录下没有不正确的.o文件和文件依赖关系，执行该命令后，内核选项会回到默认的状态下。如果你是下载的内核源码，而且是第一次编译，就没有必要执行这一步操作 
          </div> 
          <div></div> 
          <div>
            3、配置内核，修改相关参数，请参考其他资料&nbsp; 
           <wbr> 
          </div> 
          <div>
            在图形界面下，make xconfig；字符界面下，make 
           <br> menuconfig&nbsp; 
           <wbr> 
          </div> 
          <div>
            在内核配置菜单中正确设置个内核选项，保存退出&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            4、正确设置关联文件&nbsp; 
           <wbr> 
          </div> 
          <div>
            make dep&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> 根据上一步所选择的选项，建立文件的依赖关系。 
          </div> 
          <div>
            5、make clean 
          </div> 
          <div>
            清理一些不必要的文件，如果你在上次编译的基础上，删去了一些选项，建议你执行这一步操作，否则，就没有必要了。 
          </div> 
          <div></div> 
          <div>
            6、编译内核&nbsp; 
           <wbr> 
          </div> 
          <div>
            对于大内核（比如需要SCSI支持），make bzImage&nbsp; 
           <wbr> 
          </div> 
          <div>
            对于小内核，make zImage&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            7、编译模块&nbsp; 
           <wbr> 
          </div> 
          <div>
            make modules&nbsp; 
           <wbr> 
          </div> 
          <div>
            编译可加载模块（即内核选项中选择为M的选项），编译时间跟M选项的数量有关。 
          </div> 
          <div></div> 
          <div>
            8、安装模块&nbsp; 
           <wbr> 
          </div> 
          <div>
            make modules_install&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>即将编译好的modules拷贝到/lib/modules下，这就是为什么在“准备工作”的第三步提醒你备份的原因了。 
          </div> 
          <div></div> 
          <div>
            9、使用新内核 
          </div> 
          <div>
            方法一:&nbsp; 
           <wbr> 
          </div> 
          <div>
            (1)更换内核:A、mv /usr/src/linuxX.X.X/system.map &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>/boot/system.map 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>B、mv 
           <br> /usr/src/linuxX.X.X/arch/i386/boot/bzImage &nbsp; 
           <wbr> 
           <br> /boot/vmlinuz 
          </div> 
          <div>
            （2）然后修改/etc/lilo.conf文件，加一个启动选项，使用新内核bzImage/zImage启动。格式如下：&nbsp; 
           <wbr> 
          </div> 
          <div>
            boot=/dev/hda&nbsp; 
           <wbr> 
          </div> 
          <div>
            map=/boot/map&nbsp; 
           <wbr> 
          </div> 
          <div>
            install=/boot/boot.b&nbsp; 
           <wbr> 
          </div> 
          <div>
            prompt&nbsp; 
           <wbr> 
          </div> 
          <div>
            timeout=50&nbsp; 
           <wbr> 
          </div> 
          <div>
            linear&nbsp; 
           <wbr> 
          </div> 
          <div>
            default=linux-new &nbsp; 
           <wbr> &nbsp; 
           <wbr>### 
           <br> 告诉lilo缺省使用新内核启动linux ###&nbsp; 
           <wbr> 
          </div> 
          <div>
            append=”mem=256M”&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            image=/boot/vmlinuz-2.2.14-5.0&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> label=linux&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> read-only&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> root=/dev/hda5&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            image=/boot/bzImage(zImage)&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> label=linux-new&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> read-only&nbsp; 
           <wbr> 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> root=/dev/hda5&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            保留旧有的启动选项可以保证新内核不能引导的情况，还可以进入linux进行其他操作。&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            保存退出后，不要忘记了最重要的一步，运行/sbin/lilo,使修改生效&nbsp; 
           <wbr> 
          </div> 
          <div>
            方法二:使用GRUB(修改grub.conf文件) 
          </div> 
          <div>
            (1)更换内核:A、mv /usr/src/linuxX.X.X/system.map &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr>/boot/system.map 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr>B、mv 
           <br> /usr/src/linuxX.X.X/arch/i386/boot/bzImage &nbsp; 
           <wbr> 
           <br> /boot/vmlinuz 
          </div> 
          <div>
            (2)修改引导管理程序Grub，/etc/grub.conf 
          </div> 
          <div>
            内容如下： 
          </div> 
          <div>
            #boot =/dev/had 
          </div> 
          <div>
            default =0 
          </div> 
          <div>
            timeout =10 
          </div> 
          <div>
            splashimage =(hd0, 0)/grub/splash.xpm.gz 
          </div> 
          <div>
            title Red Hat Linux(2.4.20-8) 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr>root(hd0, 0) 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr>kernel /vmlinuz -2.4.20-8 
           <br> &nbsp; 
           <wbr>ro root =LABEL =/ 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr>initrd 
           <br> /initrd-2.4.20-8.img 
          </div> 
          <div>
            方法三：修改启动配置文件 
          </div> 
          <div>
            现在大多数使用的都是grub启动，需要修改/boot/grub/grub.conf，添加相应的启动信息，添加内容的最简单格式如下： 
          </div> 
          <div>
            title 显示在启动菜单上的名称 
          </div> 
          <div>
            root 根文件系统挂载分区 
          </div> 
          <div>
            kernel 压缩过的内核文件名 
          </div> 
          <div>
            initrd 根文件系统文件名 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> 如： 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> title My new kernel 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> root (hd0,2) 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> kernel /boot/vmlinuz-x.y.z 
          </div> 
          <div>
            &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> &nbsp; 
           <wbr> &nbsp; 
           <wbr> 
           <br> &nbsp; 
           <wbr> initrd /boot/initrd-x.y.z.img 
          </div> 
          <div>
            10、重新生成ram磁盘&nbsp; 
           <wbr> 
          </div> 
          <div>
            如果您的系统中的/etc/lilo.conf没有使用了ram磁盘选项initrd,略过&nbsp; 
           <wbr> 
          </div> 
          <div>
            如果您的系统中的/etc/lilo.conf使用了ram磁盘选项initrd,&nbsp; 
           <wbr> 
          </div> 
          <div>
            使用mkinitrd initrd-内核版本号 内核版本号命令重新生成ram磁盘文件，例如我的Redhat 
           <br> 6.2：&nbsp; 
           <wbr> 
          </div> 
          <div>
            mkinitrd initrd-2.2.14-5.0 2.2.14-5.0&nbsp; 
           <wbr> 
          </div> 
          <div>
            之后把/etc/lilo.conf中的initrd指向新生成的initrd-2.2.14-5.0文件：&nbsp; 
           <wbr> 
          </div> 
          <div>
            initrd=/boot/initrd-2.2.14-5.0&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            ram磁盘能使系统性能尽可能的优化，具体参考/usr/src/linux/Documents/initrd.txt文件&nbsp; 
           <wbr> 
          </div> 
          <div></div> 
          <div>
            11、重新启动,OK! 
          </div> 
         </div> 
        </div>
       </div>
       <!-- .entry-content --> 
       <!-- .entry-meta --> 
      </article>
      <!-- #post-249 --> 
      <!-- #comments --> 
     </div>
     <!-- #content --> 
    </div>
    <!-- #primary --> 
    <!-- #secondary .widget-area --> 
   </div>
   <!-- #main --> 
   <!-- #colophon --> 
  </div>
  <!-- #page -->   
  <!-- JiaThis Button BEGIN -->  
  <!-- JiaThis Button END -->   
 </body>
</html>